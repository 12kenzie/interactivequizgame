<!-- <!DOCTYPE html> -->
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="icon" type="image/x-icon" href="logo.png">
  <title>Verdict//Zero</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Press Start 2P', monospace;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background-color: #000;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      touch-action: none;
    }

    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background-color: #000;
    }

    .scene-courtroom {
      background-image: url('courtroom.png');
      background-size: cover;
      /* Automatically scales to fit screen */
      background-position: center;
      background-repeat: no-repeat;
    }

    /* Optional: Adjust for very small screens */
    @media (max-width: 768px) {
      .scene-courtroom {
        background-size: cover;
        /* Keeps full coverage */
        background-position: center bottom;
        /* Adjust focus area if needed */
      }
    }

    canvas {
      display: block;
      image-rendering: pixelated;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    #office-canvas {
      background-color: #000;
      z-index: 1;
    }

    #game-canvas {
      background-color: transparent;
      z-index: 2;
    }

    .ui-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .ui-overlay>* {
      pointer-events: auto;
    }

    .score-display {
      position: absolute;
      top: 10px;
      right: 10px;
      color: #fff;
      font-size: 10px;
      text-shadow: 2px 2px #000;
      z-index: 500;
    }

    .controls-hint {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-size: 7px;
      line-height: 1.8;
      text-shadow: 2px 2px #000;
      z-index: 500;
    }

    .audio-control {
      position: absolute;
      top: 50px;
      right: 10px;
      background-color: #000;
      color: #fff;
      border: 2px solid #fff;
      padding: 8px 12px;
      font-size: 7px;
      cursor: pointer;
      transition: all 0.1s;
      z-index: 500;
    }

    .audio-control:hover,
    .audio-control:active {
      background-color: #ff8c00;
      color: #000;
      border-color: #ff8c00;
    }

    .mobile-controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      gap: 15px;
      z-index: 500;
    }

    .mobile-dpad {
      display: grid;
      grid-template-areas: ". up ." "left . right" ". down .";
      gap: 5px;
      width: 150px;
      height: 150px;
    }

    .mobile-btn {
      background-color: rgba(0, 0, 0, 0.7);
      border: 3px solid #fff;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      touch-action: none;
    }

    .mobile-btn:active {
      background-color: #ff8c00;
      border-color: #ff8c00;
    }

    .mobile-btn.up {
      grid-area: up;
    }

    .mobile-btn.down {
      grid-area: down;
    }

    .mobile-btn.left {
      grid-area: left;
    }

    .mobile-btn.right {
      grid-area: right;
    }

    .mobile-action {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.7);
      border: 3px solid #fff;
      color: #fff;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      touch-action: none;
    }

    .mobile-action:active {
      background-color: #ff8c00;
      border-color: #ff8c00;
    }

    @media (max-width: 768px) {
      .mobile-controls {
        display: flex;
      }

      .controls-hint {
        display: none;
      }

      .score-display {
        font-size: 8px;
      }
    }

    @media (max-width: 768px) {

      .dialogue-box.active~.mobile-controls,
      .evidence-panel.active~.mobile-controls {
        display: none !important;
      }
    }

    .name-input-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .name-input-screen.hidden {
      display: none;
    }

    .name-input-box {
      background-color: #000;
      border: 6px solid #fff;
      padding: 20px;
      max-width: 600px;
      width: 100%;
      text-align: center;
    }

    .name-input-box h2 {
      color: #fff;
      font-size: 12px;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .name-display {
      background-color: #000;
      border: 4px solid #fff;
      padding: 15px;
      font-size: 18px;
      color: #fff;
      text-align: center;
      min-height: 50px;
      margin: 15px 0;
      letter-spacing: 8px;
    }

    .keyboard-container {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 5px;
      margin: 15px 0;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    @media (max-width: 768px) {
      .keyboard-container {
        grid-template-columns: repeat(7, 1fr);
        gap: 3px;
      }

      .name-display {
        font-size: 14px;
      }
    }

    .key-button {
      background-color: #000;
      color: #fff;
      border: 2px solid #fff;
      padding: 10px;
      font-size: 9px;
      cursor: pointer;
      transition: all 0.1s;
    }

    .key-button:hover:not(:disabled),
    .key-button:active:not(:disabled) {
      background-color: #ff8c00;
      color: #000;
      border-color: #ff8c00;
    }

    .key-button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .name-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .name-control-btn {
      background-color: #000;
      color: #fff;
      border: 3px solid #fff;
      padding: 12px 20px;
      font-size: 9px;
      cursor: pointer;
      transition: all 0.1s;
    }

    .name-control-btn:hover:not(:disabled),
    .name-control-btn:active:not(:disabled) {
      background-color: #ff8c00;
      color: #000;
      border-color: #ff8c00;
    }

    .name-control-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .tips-selection-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: none;
      z-index: 900;
      padding: 20px;
      overflow-y: auto;
    }

    .tips-selection-screen.active {
      display: block;
    }

    .tips-selection-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    .tips-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .tips-header h2 {
      color: #ff8c00;
      font-size: 16px;
      margin-bottom: 15px;
    }

    .tips-header p {
      color: #fff;
      font-size: 10px;
      line-height: 1.8;
    }

    .tips-grid {
      display: grid;
      gap: 20px;
      margin-bottom: 30px;
    }

    .tip-card {
      background-color: #000;
      border: 4px solid #666;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .tip-card:hover {
      border-color: #ff8c00;
      transform: translateY(-5px);
    }

    .tip-card.collected {
      border-color: #0f0;
      background-color: #001100;
    }

    .tip-card.collected::after {
      content: '✓ COLLECTED';
      position: absolute;
      top: 10px;
      right: 10px;
      color: #0f0;
      font-size: 8px;
    }

    .tip-title {
      color: #ff8c00;
      font-size: 11px;
      margin-bottom: 10px;
    }

    .tip-subtitle {
      color: #ffff00;
      font-size: 8px;
      margin-bottom: 10px;
      font-style: italic;
    }

    .tip-content {
      color: #fff;
      font-size: 9px;
      line-height: 1.6;
    }

    .tip-category {
      color: #ff8c00;
      font-size: 12px;
      margin: 30px 0 15px 0;
      border-bottom: 2px solid #ff8c00;
      padding-bottom: 10px;
    }

    .tips-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 30px;
    }

    .tips-action-btn {
      background-color: #000;
      color: #fff;
      border: 4px solid #fff;
      padding: 15px 30px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tips-action-btn:hover {
      background-color: #ff8c00;
      color: #000;
      border-color: #ff8c00;
      transform: scale(1.05);
    }

    .tips-action-btn.primary {
      border-color: #0f0;
      color: #0f0;
    }

    .tips-action-btn.primary:hover {
      background-color: #0f0;
      color: #000;
    }

    @media (max-width: 768px) {
      .tips-header h2 {
        font-size: 12px;
      }

      .tips-header p {
        font-size: 8px;
      }

      .tip-card {
        padding: 15px;
      }

      .tip-title {
        font-size: 9px;
      }

      .tip-content {
        font-size: 8px;
      }

      .tips-action-btn {
        padding: 12px 20px;
        font-size: 8px;
      }
    }

    #battle-box {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 800px;
      min-height: 350px;
      background-color: #000;
      border: 6px solid #fff;
      padding: 25px;
      display: none;
      z-index: 100;
    }

    #battle-box.active {
      display: block;
    }

     @media (max-width: 768px) {
      #battle-box {
        width: 95%;
        max-height: calc(100vh - 200px);
        min-height: 300px;
        padding: 15px;
        bottom: 180px;
        overflow-y: auto;
        overflow-x: hidden;
      }
     }

    .stats-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      font-size: 10px;
      flex-wrap: wrap;
    }

    .hp-bar-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hp-bar-outer {
      background-color: #8b0000;
      width: 120px;
      height: 20px;
      border: 2px solid #fff;
      position: relative;
    }

    .hp-bar-inner {
      background-color: #ff0;
      height: 100%;
      width: 100%;
      transition: width 0.3s ease;
    }

    .question-text {
      color: #fff;
      font-size: 14px;
      line-height: 1.8;
      margin-bottom: 25px;
      min-height: 100px;
    }

    @media (max-width: 768px) {
      .question-text {
        font-size: 11px;
        max-height: 150px;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 10px;
        min-height: auto;
      }

      /* Custom scrollbar for question text */
      #battle-box::-webkit-scrollbar {
        width: 8px;
      }

      #battle-box::-webkit-scrollbar-track {
        background: #000;
        border: 2px solid #ff8c00;
      }

      #battle-box::-webkit-scrollbar-thumb {
        background: #ff8c00;
        border-radius: 4px;
      }

      #battle-box::-webkit-scrollbar-thumb:hover {
        background: #ffa500;
      }
    }

    .answer-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .answer-buttons {
        grid-template-columns: 1fr;
      }
    }

    .answer-btn {
      background-color: #000;
      color: #ff8c00;
      border: 3px solid #ff8c00;
      padding: 18px;
      font-size: 11px;
      cursor: pointer;
      text-align: left;
      transition: all 0.1s;
      font-weight: bold;
    }

    .answer-btn:hover:not(:disabled) {
      background-color: #ffa500;
      color: #000;
      border-color: #ffa500;
    }

    .answer-btn.correct {
      background-color: #0f0;
      color: #000;
      border-color: #0f0;
    }

    .answer-btn.wrong {
      background-color: #f00;
      color: #fff;
      border-color: #f00;
    }

    #ready-btn:hover:not(:disabled) {
      background-color: #0f0;
      color: black;
      border-color: #0f0;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-btn {
      background-color: #000;
      color: #fff;
      border: 3px solid #fff;
      padding: 12px 25px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.1s;
    }

    .action-btn:hover:not(:disabled) {
      background-color: #ff8c00;
      color: #000;
      border-color: #ff8c00;
    }

    #enemy-sprite {
      position: absolute;
      top: 12%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 100px;
      text-align: center;
      z-index: 50;
      display: none;
    }

    #enemy-sprite.active {
      display: block;
    }

    .dialogue-box {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #000;
      border: 6px solid #fff;
      padding: 25px;
      width: 90%;
      max-width: 800px;
      min-height: 280px;
      display: none;
      z-index: 150;
    }

    /* Speaker label shown above the dialogue text to indicate who is speaking */
    .speaker-label {
      font-size: 11px;
      color: #000;
      background: #ff8c00;
      display: inline-block;
      padding: 6px 10px;
      border-radius: 6px;
      margin-bottom: 12px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    /* Speaker-specific styles applied to the dialogue-box for visual separation */
    .dialogue-box.judge {
      border-color: #4169e1;
    }

    .dialogue-box.prosecutor {
      border-color: #0f0;
    }

    .dialogue-box.defense {
      border-color: #f00;
    }

    .dialogue-box.active {
      display: block;
    }

    @media (max-width: 768px) {
      .dialogue-box {
        width: 95%;
        padding: 15px;
        bottom: 180px;
      }
    }

    .dialogue-text {
      color: #fff;
      font-size: 14px;
      line-height: 1.8;
      min-height: 150px;
    }

    @media (max-width: 768px) {
      .dialogue-text {
        font-size: 11px;
      }
    }

    .dialogue-prompt {
      color: #ff8c00;
      font-size: 9px;
      margin-top: 15px;
      text-align: right;
    }

    .end-screen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background-color: #000;
      border: 6px solid #fff;
      padding: 40px;
      display: none;
      z-index: 200;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .end-screen.active {
      display: block;
    }

    .end-screen h2 {
      font-size: 18px;
      margin-bottom: 20px;
      color: #fff;
    }

    .end-screen p {
      font-size: 11px;
      line-height: 1.8;
      margin-bottom: 20px;
      color: #fff;
    }

    .restart-btn {
      background-color: #000;
      color: #ff8c00;
      border: 4px solid #ff8c00;
      padding: 15px 30px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.1s;
      font-weight: bold;
    }

    .restart-btn:hover {
      background-color: #ffa500;
      border-color: #ffa500;
      color: #000;
    }

    #inventory-content {
      text-align: left;
      margin: 20px 0;
    }

    .inventory-item {
      background-color: #111;
      border: 2px solid #ff8c00;
      padding: 15px;
      margin-bottom: 15px;
    }

    .inventory-item-title {
      color: #ff8c00;
      font-size: 10px;
      margin-bottom: 8px;
    }

    .inventory-item-subtitle {
      color: #ffff00;
      font-size: 8px;
      margin-bottom: 8px;
      font-style: italic;
    }

    .inventory-item-content {
      color: #fff;
      font-size: 9px;
      line-height: 1.6;
    }

    .empty-inventory {
      color: #666;
      font-size: 10px;
      text-align: center;
      padding: 30px;
    }

    .scene-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
    }

    .scene-library {
      background: linear-gradient(to bottom, #1a0a00 0%, #4a2600 50%, #1a0a00 100%);
    }

    .scene-courtroom {
      background: linear-gradient(to bottom, #0a0a1a 0%, #1a1a4a 50%, #0a0a1a 100%);
    }

    .scene-background::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background-size: 100px 100px;
      opacity: 0.1;
    }

    .scene-library::before {
      background-image: repeating-linear-gradient(0deg, transparent, transparent 35px, #8b4513 35px, #8b4513 36px), repeating-linear-gradient(90deg, transparent, transparent 35px, #8b4513 35px, #8b4513 36px);
    }

    .scene-courtroom::before {
      background-image: repeating-linear-gradient(0deg, transparent, transparent 50px, #4169e1 50px, #4169e1 51px);
    }

    .scene-decoration {
      position: absolute;
      font-size: 60px;
      opacity: 0.2;
      pointer-events: none;
    }

    .hidden {
      display: none !important;
    }

    .transition-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      opacity: 0;
      pointer-events: none;
      z-index: 999;
    }

    .rank-display {
      color: #ff8c00;
      font-size: 16px;
      margin: 15px 0;
      font-weight: bold;
      text-shadow: 2px 2px #000;
    }

    .inventory-item-content {
      color: #fff;
      font-size: 9px;
      line-height: 1.6;
    }

    .empty-inventory {
      color: #666;
      font-size: 10px;
      text-align: center;
      padding: 30px;
    }

    .hidden {
      display: none !important;
    }

    /* START MENU STYLES */
    .start-menu {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .start-menu.hidden {
      display: none;
    }

    .start-menu-content {
      text-align: center;
      padding: 40px;
      max-width: 600px;
    }

    .game-title {
      font-size: 48px;
      color: #ff8c00;
      margin-bottom: 20px;
      text-shadow: 4px 4px #000, 6px 6px #ff0000;
      animation: titlePulse 2s infinite;
    }

    @keyframes titlePulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    .game-subtitle {
      font-size: 14px;
      color: #fff;
      margin-bottom: 60px;
      letter-spacing: 2px;
    }

    .start-menu-buttons {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 40px;
    }

    .start-menu-btn {
      background-color: #000;
      color: #ff8c00;
      border: 4px solid #ff8c00;
      padding: 20px 40px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .start-menu-btn:hover,
    .start-menu-btn:focus {
      background-color: #ff8c00;
      color: #000;
      transform: scale(1.05);
    }

    .start-menu-btn::before {
      content: '▶';
      position: absolute;
      left: 20px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .start-menu-btn:hover::before {
      opacity: 1;
    }

    .start-hint {
      font-size: 10px;
      color: #888;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {

      0%,
      49% {
        opacity: 1;
      }

      50%,
      100% {
        opacity: 0.3;
      }
    }

    @media (max-width: 768px) {
      .start-menu-content {
        padding: 20px;
        max-width: 90%;
      }

      .game-title {
        font-size: 24px;
        margin-bottom: 15px;
        text-shadow: 3px 3px #000, 4px 4px #ff0000;
        line-height: 1.4;
        word-wrap: break-word;
      }

      .game-subtitle {
        font-size: 8px;
        margin-bottom: 40px;
        letter-spacing: 1px;
        line-height: 1.6;
      }

      .start-menu-buttons {
        gap: 15px;
        margin-bottom: 30px;
      }

      .start-menu-btn {
        padding: 12px 20px;
        font-size: 9px;
        border: 3px solid #ff8c00;
      }

      .start-menu-btn::before {
        left: 10px;
        font-size: 8px;
      }

      .start-hint {
        font-size: 8px;
        line-height: 1.6;
      }
    }

    /* Extra small screens */
    @media (max-width: 480px) {
      .game-title {
        font-size: 20px;
      }

      .game-subtitle {
        font-size: 7px;
      }

      .start-menu-btn {
        padding: 10px 15px;
        font-size: 8px;
      }

      .start-hint {
        font-size: 7px;
      }
    }

    /* Evidence Panel Styles */
    .evidence-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.95);
      display: none;
      z-index: 1500;
    }

    .evidence-panel.active {
      display: flex;
    }

    .evidence-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    .evidence-header {
      text-align: center;
      padding: 20px;
      border-bottom: 4px solid #ff8c00;
      margin-bottom: 20px;
    }

    .evidence-header h2 {
      color: #ff8c00;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .evidence-header p {
      color: #fff;
      font-size: 8px;
      line-height: 1.6;
    }

    .evidence-display {
      display: flex;
      flex: 1;
      gap: 20px;
      overflow: hidden;
    }

    .evidence-list {
      width: 35%;
      overflow-y: auto;
      padding-right: 10px;
    }

    .evidence-card {
      background-color: #111;
      border: 3px solid #666;
      padding: 15px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .evidence-card:hover {
      border-color: #ff8c00;
      background-color: #1a1a00;
      transform: translateX(5px);
    }

    .evidence-card.selected {
      border-color: #0f0;
      background-color: #001100;
    }

    .evidence-icon {
      width: 60px;
      height: 60px;
      background-color: #333;
      border: 2px solid #666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      flex-shrink: 0;
    }

    .evidence-card.selected .evidence-icon {
      border-color: #0f0;
    }

    .evidence-card-info {
      flex: 1;
    }

    .evidence-card-title {
      color: #ff8c00;
      font-size: 10px;
      margin-bottom: 5px;
    }

    .evidence-card-type {
      color: #888;
      font-size: 7px;
    }

    .evidence-detail {
      width: 65%;
      background-color: #000;
      border: 4px solid #ff8c00;
      padding: 30px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .evidence-detail-image {
      width: 300px;
      height: 300px;
      background-color: #222;
      border: 3px solid #ff8c00;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
    }

    .evidence-detail-title {
      color: #ff8c00;
      font-size: 14px;
      margin-bottom: 10px;
      text-align: center;
    }

    .evidence-detail-type {
      color: #ffff00;
      font-size: 9px;
      margin-bottom: 20px;
      text-align: center;
    }

    .evidence-detail-description {
      color: #fff;
      font-size: 10px;
      line-height: 1.8;
      text-align: left;
      max-width: 500px;
    }

    .evidence-footer {
      text-align: center;
      padding: 20px;
      border-top: 4px solid #ff8c00;
      margin-top: 20px;
    }

    .evidence-footer p {
      color: #ff8c00;
      font-size: 8px;
    }

    .evidence-close-btn {
      background-color: #000;
      color: #fff;
      border: 3px solid #fff;
      padding: 12px 30px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 15px;
    }

    .evidence-close-btn:hover {
      background-color: #ff8c00;
      color: #000;
      border-color: #ff8c00;
    }

    .evidence-submit-btn {
      background-color: #000;
      color: #0f0;
      border: 3px solid #0f0;
      padding: 12px 30px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 15px;
      display: none;
    }
    
    .evidence-submit-btn:hover {
      background-color: #0f0;
      color: #000;
      border-color: #0f0;
    }
    
    .evidence-submit-btn.active {
      display: inline-block;
    }

    @media (max-width: 768px) {
      .evidence-display {
        flex-direction: column;
      }

      .evidence-list {
        width: 100%;
        max-height: 40%;
      }

      .evidence-detail {
        width: 100%;
      }

      .evidence-detail-image {
        width: 200px;
        height: 200px;
        font-size: 60px;
      }
    }

    .evidence-card.answer-mode {
      border-color: #0f0;
      background-color: #002200;
      animation: evidencePulse 1s infinite;
    }

    @keyframes evidencePulse {

      0%,
      100% {
        border-color: #0f0;
      }

      50% {
        border-color: #00ff00;
      }
    }
  </style>
</head>

<body>
  <div id="game-container">
    <div class="scene-background scene-library hidden" id="library-scene">
      <div class="scene-decoration" style="top: 10%; left: 10%;">📚</div>
      <div class="scene-decoration" style="top: 15%; right: 15%;">📖</div>
      <div class="scene-decoration" style="bottom: 20%; left: 20%;">📜</div>
      <div class="scene-decoration" style="bottom: 15%; right: 10%;">🏛️</div>
    </div>
    <div class="scene-background scene-courtroom hidden" id="courtroom-scene">
      <div class="scene-decoration" style="top: 10%; left: 50%; transform: translateX(-50%);">⚖️</div>
      <div class="scene-decoration" style="top: 20%; left: 15%;">🏛️</div>
      <div class="scene-decoration" style="top: 20%; right: 15%;">🏛️</div>
      <div class="scene-decoration" style="bottom: 20%; left: 20%;">📋</div>
      <div class="scene-decoration" style="bottom: 20%; right: 20%;">⚖️</div>
    </div>
    <div class="transition-overlay" id="transition-overlay"></div>
    <canvas id="office-canvas"></canvas>
    <canvas id="game-canvas"></canvas>
    <div class="ui-overlay">
      <div class="start-menu" id="start-menu">
        <div class="start-menu-content">
          <h1 class="game-title">VERDICT//ZERO</h1>
          <p class="game-subtitle">A Legal Thriller Adventure</p>
          <div class="start-menu-buttons">
            <button class="start-menu-btn" id="start-game-btn">★ START GAME</button>
            <button class="start-menu-btn" id="credits-btn">★ CREDITS</button>
          </div>
          <p class="start-hint">Press ENTER or click START GAME to begin</p>
        </div>
      </div>
      <div class="name-input-screen" id="name-screen">
        <div class="name-input-box">
          <h2>Name the Attorney.</h2>
          <div class="name-display" id="name-display"></div>
          <div class="keyboard-container" id="keyboard"></div>
          <div class="name-controls">
            <button class="name-control-btn" id="backspace-btn">Backspace</button>
            <button class="name-control-btn" id="quit-btn">Quit</button>
            <button class="name-control-btn" id="done-btn">Done</button>
          </div>
        </div>
      </div>

      <div class="tips-selection-screen" id="tips-screen">
        <div class="tips-selection-container">
          <div class="tips-header">
            <h2>LEGAL RESOURCES LIBRARY</h2>
            <p>* Click on any resource to collect it for your investigation.<br>* These will be stored in your inventory
              for reference during the trial.</p>
          </div>

          <div class="tip-category">VOCABULARY BOOK</div>
          <div class="tips-grid" id="vocabulary-grid"></div>

          <div class="tip-category">LEGAL SCROLL</div>
          <div class="tips-grid" id="legal-grid"></div>

          <div class="tips-actions">
            <button class="tips-action-btn" id="skip-tips-btn">Skip All</button>
            <button class="tips-action-btn primary" id="proceed-btn">Proceed to Trial (<span
                id="collected-count">0</span> collected)</button>
          </div>
        </div>
      </div>

      <div class="score-display">SCORE: <span id="score">0</span></div>
      <button class="audio-control" id="audio-toggle">SOUND: ON</button>
      <div class="controls-hint">ARROW KEYS: Move<br>Z/ENTER: Interact</div>

      <div class="mobile-controls" id="mobile-controls">
        <div class="mobile-dpad">
          <button class="mobile-btn up" id="mobile-up">▲</button>
          <button class="mobile-btn down" id="mobile-down">▼</button>
          <button class="mobile-btn left" id="mobile-left">◀</button>
          <button class="mobile-btn right" id="mobile-right">▶</button>
        </div>
        <button class="mobile-action" id="mobile-action">Z</button>
        <button class="mobile-action" id="mobile-evidence" style="display:none;">📋</button>
      </div>

      <div id="enemy-sprite">⚖️</div>

      <div class="dialogue-box" id="dialogue-box">
        <div class="speaker-label" id="speaker-label" style="display:none"></div>
        <div class="dialogue-text" id="dialogue-text"></div>
        <div class="dialogue-prompt">Press Z or ENTER to continue...</div>
      </div>

      <div class="dialogue-box" id="tips-choice-box">
        <div class="dialogue-text" id="tips-choice-text">* What would you like to learn about?</div>
        <div class="answer-buttons" style="margin-top: 20px;" id="tips-menu">
          <button class="answer-btn" id="vocab-btn">★ Gender-based Harassment</button>
          <button class="answer-btn" id="legal1-btn">★ Anti-Photo/Voyeurism Act</button>
          <button class="answer-btn" id="legal2-btn">★ Safe Spaces Act</button>
          <button class="answer-btn" id="legal3-btn">★ Cybercrime Prevention Act of 2012</button>
          <button class="answer-btn" id="ready-btn" style="grid-column: 1 / -1; border-color: #0f0; color: #0f0;">★ I'm
            Ready for the Trial</button>
        </div>
      </div>

      <div id="battle-box">
        <div class="stats-bar">
          <span id="player-name">ATTORNEY</span>
          <span>LV <span id="level">1</span></span>
          <div class="hp-bar-container">
            <span>CRED</span>
            <div class="hp-bar-outer">
              <div class="hp-bar-inner" id="hp-bar"></div>
            </div>
            <span><span id="current-hp">20</span> / <span id="max-hp">20</span></span>
          </div>
        </div>
        <div class="question-text" id="question-text"></div>
        <div class="answer-buttons" id="answer-buttons"></div>
        <div class="action-buttons">
          <button class="action-btn" id="act-btn">★ ACT</button>
          <button class="action-btn" id="item-btn">★ INVENTORY</button>
          <button class="action-btn" id="mercy-btn">★ MERCY</button>
        </div>
      </div>

      <div class="end-screen" id="inventory-modal">
        <h2>📚 YOUR COLLECTED RESOURCES</h2>
        <div id="inventory-content"></div>
        <button class="restart-btn" id="close-inventory-btn">Close</button>
      </div>

      <div class="end-screen" id="victory-screen">
        <h2>★ CASE WON! ★</h2>
        <p>You've successfully gathered all evidence and won the case!</p>
        <p>Final Score: <span id="final-score-victory">0</span></p>
        <button class="restart-btn" id="restart-victory">Play Again</button>
      </div>

      <div class="end-screen" id="gameover-screen">
        <h2>CASE DISMISSED</h2>
        <p>The case was dismissed due to insufficient evidence...</p>
        <p>Final Score: <span id="final-score-gameover">0</span></p>
        <button class="restart-btn" id="restart-gameover">Try Again</button>
      </div>

      <div class="evidence-panel" id="evidence-panel">
        <div class="evidence-container">
          <div class="evidence-header">
            <h2>📋 EVIDENCE COURT RECORD</h2>
            <p>Press TAB or ESC to close | Use ARROW KEYS or MOUSE to navigate</p>
          </div>

          <div class="evidence-display">
            <div class="evidence-list" id="evidence-list">
              <!-- Evidence cards will be inserted here -->
            </div>

            <div class="evidence-detail" id="evidence-detail">
              <div class="evidence-detail-image" id="evidence-image">📄</div>
              <div class="evidence-detail-title" id="evidence-title">Select an evidence</div>
              <div class="evidence-detail-type" id="evidence-type">Click on evidence to view details</div>
              <div class="evidence-detail-description" id="evidence-description">
                Navigate through the evidence list to examine each piece of evidence collected during the investigation.
              </div>
            </div>
          </div>

          <div class="evidence-footer">
            <p>EVIDENCE COUNT: <span id="evidence-count">0</span> / <span id="evidence-total">10</span></p>
            <button class="evidence-submit-btn" id="evidence-submit-btn">★ SUBMIT EVIDENCE ★</button>
            <button class="evidence-close-btn" id="evidence-close-btn">Close Evidence Panel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script>
    // Background office canvas
    const officeCanvas = document.getElementById('office-canvas');
    const officeCtx = officeCanvas.getContext('2d');
    officeCanvas.width = window.innerWidth;
    officeCanvas.height = window.innerHeight;

    // Foreground game canvas (for player/NPCs)
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

    // Enhanced color palette for office background
    const officeColors = {
      floor: '#5A4A3A',
      floorDark: '#3E2F23',
      floorLight: '#6F5E4D',
      wall: '#2A2A2A',
      wallDark: '#1A1A1A',
      wallLight: '#3A3A3A',
      desk: '#3E2723',
      deskDark: '#2A1A15',
      deskLight: '#5C3828',
      carpet: '#5C0000',
      carpetDark: '#3A0000',
      gold: '#B8860B',
      goldDark: '#8B6914',
      plant: '#1A5A1A',
      plantDark: '#0F3A0F',
      plantLight: '#287028',
      wood: '#5C3317',
      woodDark: '#5C2E0A',
      bookshelf: '#654321',
      paper: '#C8C8C8',
      paperDark: '#A0A0A0',
      lamp: '#FFA500',
      lampBase: '#B8860B'
    };
    // Dust particles
    let particles = [];
    for (let i = 0; i < 30; i++) {
      particles.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        size: Math.random() * 2 + 1,
        speedY: Math.random() * 0.3 + 0.1,
        speedX: (Math.random() - 0.5) * 0.2,
        opacity: Math.random() * 0.3 + 0.1
      });
    }
    // Animation state for background
    let officeAnimFrame = 0;
    const plantSway = [0, 1, 2, 1, 0, -1, -2, -1];
    const screenFlicker = [0, 0, 0, 0, 1, 0, 0, 0];
    const lampGlow = [0, 1, 2, 3, 2, 1];

    let soundEnabled = true;
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    const bgMusic = new Audio();
    bgMusic.loop = true;
    bgMusic.volume = 0.3;

    // Background music tracks for different game states
    const bgmTracks = {
      menu: 'music/start-menu.mp3',           // Your menu music file
      walking: 'music/walking.mp3',     // Your library music file
      courtroom: 'music/courtroom.mp3', // Your courtroom music file
      battle: 'music/battle.mp3',       // Your battle music file
      victory: 'music/victory.mp3',     // Your victory music file
      gameover: 'music/gameover.mp3'    // Your gameover music file
    };

    let currentTrack = null;

    function playBackgroundMusic() {
      if (soundEnabled && bgMusic.src) {
        bgMusic.play().catch(e => console.log('Music play failed:', e));
      }
    }

    function stopBackgroundMusic() {
      bgMusic.pause();
      bgMusic.currentTime = 0;
    }

    // Function to change background music based on game state
    function changeBackgroundMusic(trackName) {
      if (!soundEnabled) return;

      // Don't restart if same track is already playing
      if (currentTrack === trackName && !bgMusic.paused) return;

      // Stop current music
      stopBackgroundMusic();

      // Load and play new track with fade-in
      if (bgmTracks[trackName]) {
        bgMusic.src = bgmTracks[trackName];
        bgMusic.volume = 0;
        currentTrack = trackName;
        playBackgroundMusic();

        // Fade in
        let vol = 0;
        const fadeIn = setInterval(() => {
          if (vol < 0.3) {
            vol += 0.05;
            bgMusic.volume = Math.min(vol, 0.3);
          } else {
            clearInterval(fadeIn);
          }
        }, 50);
      }
    }

    // Play short sound effects (like objections)
    function playSoundEffect(effectName) {
      if (!soundEnabled || !bgmTracks[effectName]) return;

      const sfx = new Audio(bgmTracks[effectName]);
      sfx.volume = 0.5;
      sfx.play().catch(e => console.log('SFX play failed:', e));
      document.getElementById('done-btn').onclick
    }

    function playBeep(freq = 440, dur = 0.1, type = 'square') {
      if (!soundEnabled) return;
      const osc = audioContext.createOscillator(), gain = audioContext.createGain();
      osc.connect(gain); gain.connect(audioContext.destination);
      osc.frequency.value = freq; osc.type = type;
      gain.gain.setValueAtTime(0.3, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + dur);
      osc.start(audioContext.currentTime); osc.stop(audioContext.currentTime + dur);
    }

    const sounds = {
      menuMove: () => playBeep(300, 0.05),
      menuSelect: () => playBeep(600, 0.1),
      textBlip: () => playBeep(200, 0.03),
      collect: () => { playBeep(523, 0.1); setTimeout(() => playBeep(659, 0.15), 100); },
      correct: () => { playBeep(523, 0.1); setTimeout(() => playBeep(659, 0.1), 100); setTimeout(() => playBeep(784, 0.2), 200); },
      wrong: () => playBeep(200, 0.3, 'sawtooth'),
      victory: () => { playBeep(523, 0.15); setTimeout(() => playBeep(659, 0.15), 150); setTimeout(() => playBeep(784, 0.15), 300); setTimeout(() => playBeep(1047, 0.3), 450); }
    };

    document.getElementById('audio-toggle').onclick = () => {
      soundEnabled = !soundEnabled;
      document.getElementById('audio-toggle').textContent = soundEnabled ? 'SOUND: ON' : 'SOUND: OFF';
      if (soundEnabled) {
        sounds.menuSelect();
        playBackgroundMusic();
      } else {
        stopBackgroundMusic();
      }
    };

    const mobileKeys = { up: false, down: false, left: false, right: false };
    if (isMobile) {
      document.getElementById('mobile-controls').style.display = 'flex';
      ['up', 'down', 'left', 'right'].forEach(dir => {
        const btn = document.getElementById(`mobile-${dir}`);
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); mobileKeys[dir] = true; });
        btn.addEventListener('touchend', (e) => { e.preventDefault(); mobileKeys[dir] = false; });
      });
      document.getElementById('mobile-action').addEventListener('touchstart', (e) => {
        e.preventDefault();
        sounds.menuSelect();

        // Handle question dialogues
        if (inQuestionDialogue) {
          if (isTyping) {
            isTyping = false;
            document.getElementById('dialogue-text').textContent = targetText;
          } else {
            showNextQuestionDialogue();
          }
          return;
        }

        // Handle question confirm prompts
        if (waitingForQuestionConfirm) {
          if (isTyping) {
            isTyping = false;
            document.getElementById('dialogue-text').textContent = targetText;
          } else {
            waitingForQuestionConfirm = false;
            const dialogueBox = document.getElementById('dialogue-box');
            const battleBox = document.getElementById('battle-box');
            gsap.to('#dialogue-box', {
              opacity: 0, duration: 0.3, onComplete: () => {
                dialogueBox.classList.remove('active');
                if (battleBox) {
                  battleBox.classList.add('active');
                  gsap.fromTo('#battle-box', { opacity: 0 }, { opacity: 1, duration: 0.3 });
                }
                if (questionConfirmCallback) {
                  const cb = questionConfirmCallback;
                  questionConfirmCallback = null;
                  cb();
                }
              }
            });
          }
          return;
        }

        // Regular dialogue handling
        if (gameMode === 'walking' && canInteract) {
          startDialogue();
        } else if (gameMode === 'dialogue' && !isTyping) {
          showNextDialogue();
        } else if (gameMode === 'dialogue' && isTyping) {
          isTyping = false;
          document.getElementById('dialogue-text').textContent = targetText;
        }
      });
      // Mobile evidence button handler
      const mobileEvidenceBtn = document.getElementById('mobile-evidence');
      if (mobileEvidenceBtn) {
        mobileEvidenceBtn.addEventListener('touchstart', (e) => {
          e.preventDefault();
          sounds.menuSelect();
          if (evidenceAnswerMode) {
            submitEvidenceAnswer();
          } else {
            const evidencePanel = document.getElementById('evidence-panel');
            if (evidencePanel.classList.contains('active')) {
              closeEvidencePanel();
            } else if (gameMode === 'quiz') {
              openEvidencePanel();
            }
          }
        });
      }

      // Function to update mobile controls visibility
      function updateMobileControls() {
        const mobileControls = document.getElementById('mobile-controls');
        const mobileEvidence = document.getElementById('mobile-evidence');

        if (gameMode === 'quiz' && mobileEvidence) {
          mobileEvidence.style.display = 'flex';
          mobileControls.classList.add('quiz-mode');
        } else if (mobileEvidence) {
          mobileEvidence.style.display = 'none';
          mobileControls.classList.remove('quiz-mode');
        }
      }
    }

    let gameMode = 'startMenu', playerName = '', currentName = '';
    const MAX_NAME_LENGTH = 7;
    let score = 0, maxHP = 20, currentHP = 20, currentQuestionIndex = 0, dialogueIndex = 0, canInteract = false, answeringQuestion = false;
    const player = { x: canvas.width / 2, y: canvas.height / 2, size: 20, speed: 4, color: '#ff0000' };
    const npc = { x: canvas.width / 2, y: 180, size: 40, color: '#ffff00' };
    const keys = {};

    // START MENU FUNCTIONALITY
    function showStartMenu() {
      gameMode = 'startMenu';
      document.getElementById('start-menu').classList.remove('hidden');
      changeBackgroundMusic('menu');
      gsap.fromTo('#start-menu',
        { opacity: 0 },
        { opacity: 1, duration: 1 }
      );
    }

    function hideStartMenu(callback) {
      sounds.menuSelect();
      gsap.to('#start-menu', {
        opacity: 0,
        duration: 0.5,
        onComplete: () => {
          document.getElementById('start-menu').classList.add('hidden');
          if (callback) callback();
        }
      });
    }

    function showNameEntry() {
      gameMode = 'nameEntry';
      document.getElementById('name-screen').classList.remove('hidden');
      gsap.fromTo('#name-screen',
        { opacity: 0, scale: 0.9 },
        { opacity: 1, scale: 1, duration: 0.5 }
      );
    }

    function showCredits() {
      sounds.menuSelect();
      hideStartMenu(() => {
        const dialogueBox = document.getElementById('dialogue-box');
        const dialogueText = document.getElementById('dialogue-text');

        // Center the dialogue box for credits
        dialogueBox.style.bottom = 'auto';
        dialogueBox.style.top = '50%';
        dialogueBox.style.transform = 'translate(-50%, -50%)';

        // Center-align text and preserve line breaks
        dialogueText.style.textAlign = 'center';
        dialogueText.style.whiteSpace = 'pre-line';

        const creditsText = `★ VERDICT//ZERO ★

A Legal Thriller Adventure Game

CREATED BY:
12-REVERIE GROUP 4

SPRITES:
ARCE, MIGUEL PHILIP

CONTENTS AND DIALOGUES:
GUINTO, YOHAN
NOLASCO, TERENCE DOMINIC D.
AMOR, ROZEAH
ADEVA, ALLIANA YSABELLE

PROGRAMMING:
RIGUER, MACKENZIE C.

SPECIAL THANKS:
To all advocates fighting
gender-based violence

Press Z or ENTER to return`;

        dialogueBox.classList.add('active');
        gsap.fromTo('#dialogue-box',
          { opacity: 0, scale: 0.9 },
          { opacity: 1, scale: 1, duration: 0.5 }
        );

        typeText(creditsText, dialogueText, () => {
          // Wait for player input to return
          const returnHandler = (e) => {
            if (e.key === 'z' || e.key === 'Z' || e.key === 'Enter') {
              sounds.menuSelect();
              document.removeEventListener('keydown', returnHandler);

              gsap.to('#dialogue-box', {
                opacity: 0, scale: 0.9, duration: 0.3,
                onComplete: () => {
                  dialogueBox.classList.remove('active');
                  // Reset dialogue box position and text alignment
                  dialogueBox.style.bottom = '20px';
                  dialogueBox.style.top = 'auto';
                  dialogueBox.style.transform = 'translateX(-50%)';
                  dialogueText.style.textAlign = 'left';
                  dialogueText.style.whiteSpace = 'normal';
                  showStartMenu();
                }
              });
            }
          };
          document.addEventListener('keydown', returnHandler);

          // Mobile support
          const mobileHandler = () => {
            sounds.menuSelect();
            document.getElementById('mobile-action').removeEventListener('touchstart', mobileHandler);
            document.removeEventListener('keydown', returnHandler);

            gsap.to('#dialogue-box', {
              opacity: 0, scale: 0.9, duration: 0.3,
              onComplete: () => {
                dialogueBox.classList.remove('active');
                // Reset dialogue box position and text alignment
                dialogueBox.style.bottom = '20px';
                dialogueBox.style.top = 'auto';
                dialogueBox.style.transform = 'translateX(-50%)';
                dialogueText.style.textAlign = 'left';
                dialogueText.style.whiteSpace = 'normal';
                showStartMenu();
              }
            });
          };
          document.getElementById('mobile-action').addEventListener('touchstart', mobileHandler, { once: true });
        });
      });
    }

    // START MENU EVENT LISTENERS
    document.getElementById('start-game-btn').onclick = () => {
      hideStartMenu(() => {
        showNameEntry();
      });
    };

    document.getElementById('credits-btn').onclick = () => {
      hideStartMenu(() => {
        showCredits();
      });
    };

    const availableTips = {};
    let collectedTips = [];

    // Evidence system
    let collectedEvidence = [];
    let selectedEvidenceIndex = 0;

    // Placeholder evidence data (replace icons with your PNG URLs later)
    const evidenceDatabase = [
      {
        id: 'evidence1',
        title: "Evidence 001: Samsung Galaxy S21 (Defendant's Phone)",
        type: 'Physical Evidence',
        icon: './evidences/evidence-1.png',
        description: 'Registered to Dwg under SIM Registration records. Contains the multiple accounts and  applications used for harassment: (Messenger, Instagram, and Facebook.)(One notable thing is the Messenger and Facebook account are different)'
      },
      {
        id: 'evidence2',
        title: 'Evidence 002: Chat Log Transcript Alpha',
        type: 'Digital Evidence',
        icon: './evidences/evidence-2.png',
        description: ' On March 15, 2025, a message exchange revealed the defendant\'s phone number (+63-917-5554-XXX) and messenger account sending suggestive texts to the victim - Some examples are "You know you want me," alongside comments fixating on their physique, then demanding attention because he believed his attraction was mutual'
      },
      {
        id: 'evidence3',
        title: 'Evidence 003: Chat Log Transcript Beta',
        type: 'Digital Evidence',
        icon: './evidences/evidence-3.png',
        description: 'Instagram DM thread from March 20-April 10, 2025, showing 47 messages of persistent unwanted romantic advances. The victim responded on March 23, texting  "Please stop contacting me." But the defendant continued sending messages including: "You\'re so sexy in your stories," "I deserve a chance," "Don\'t be so cold to me."'
      },
      {
        id: 'evidence4',
        title: ' Evidence 004: CCTV Footage of NAIA Terminal 3',
        type: 'Video Evidence',
        icon: './evidences/evidence-4.png',
        description: 'Dated February 8, 2025, 2:15 PM, showing defendant at Ninoy Aquino International Airport taking a photo under victim\'s skirt while victim (female lawyer Maria) was seated waiting for her flight. The footage shows him holding his phone down low.'
      },
      {
        id: 'evidence5',
        title: 'Evidence 005: the unauthorized picture',
        type: 'Photographic Evidence',
        icon: './evidences/evidence-5.png',
        description: 'The result of the unauthorized photograph taken at NAIA, recovered from the defendant\'s phone during forensic analysis. Experts checked its details; the date and time, proving to be  February 8, 2025, 2:15 PM, lining up perfectly with the CCTV footage.'
      },
      {
        id: 'evidence6',
        title: 'Evidence 006: Digital Forensics Report',
        type: 'Technical Analysis',
        icon: './evidences/evidence-6.png',
        description: 'Technical analysis by the NBI Cybercrime Division confirming IP addresses, device metadata, and account ownership linking all harassment materials to the defendant. It traces their activity everywhere online, proving the collected evidence is truly from the defendant.'
      },
      {
        id: 'evidence7',
        title: "Evidence 007: Victim's Account",
        type: 'Testimonial Evidence',
        icon: './evidences/evidence-7.png',
        description: 'Ms. Maria\'s statement detailing psychological distress, anxiety, and fear caused by the defendant\'s actions. Additional statement from Maria  describing trauma and violation of  privacy from the upskirt photography incident.'
      },
      {
        id: 'evidence8',
        title: 'Evidence 008:  Screenshot of Public Facebook Post',
        type: 'Digital Evidence',
        icon: './evidences/evidence-8.png',
        description: "Facebook post by defendant from May 2, 2025: 'Maria is secretly gay but pretends to be straight to get men. I have proof he's been lying to everyone. The post was shared 847 times, reaching approximately 47,000 users before it was taken down."
      },
      {
        id: 'evidence9',
        title: ' Evidence 009: Institutional Policy Document',
        type: 'Legal Document',
        icon: './evidences/evidence-9.png',
        description: "Copy of the workplace's Safe Spaces Act compliance policy, showing the employer's established process for addressing gender-based harassment complaints, including the Committee on Decorum and Investigation (CODI) procedures as well as the records of the recently done investigations."
      },
      {
        id: 'evidence10',
        title: 'Evidence 010: Expert Psychological Report',
        type: 'Medical Evidence',
        icon: './evidences/evidence-10.png',
        description: "Licensed psychologist's assessment of Ms. Maria noted that she had significant anxiety , trouble sleeping, alongside a drop in work quality - all stemming from the ongoing online abuse."
      }
    ];

    // Initialize evidence collection (evidence gets collected automatically for demo purposes)
    function initializeEvidence() {
      // For now, collect all evidence automatically
      // Later you can make this conditional based on correct answers
      collectedEvidence = evidenceDatabase.map(e => ({ ...e }));
      updateEvidenceDisplay();
    }

    const narratorDialogues = [
      () => `* Welcome Attorney ${playerName}! As you may know, you have been called here to solve a particular case in which a public figure "X" and some authorities have been caught engaging in online-based violence.`,
      "* A female lawyer was the one who filed the case. According to her, she was preparing to travel when someone captured a photo under her skirt without her consent.",
      "* To gather all of the evidence that you need in your investigation, you must answer all of the questions correctly.",
      "* This evidence is important for building a strong case in court to win. Choose your answer wisely.",
      "* The courtroom awaits. It's not just a case; it's a fight for dignity, respect, and justice in the face of online gender-based violence."
    ];

    const npcTipsDialogues = [
      "* Since it's your first time attending a court hearing, here are some tips that you could use.",
      "* Don't worry, though; it could also be viewed later whenever you need a short refresher about it.",
      "* What would you like to learn about?"
    ];

    const tipsInfo = {
      vocab1: {
        title: "Gender-based Harassment",
        dialogue: "* Gender-based Harassment is a kind of harassment wherein someone is treated badly because of their gender. This is an important concept to understand for this case."
      },
      legal1: {
        title: "Section 4(a) of Republic Act 9995",
        subtitle: "Anti-Photo or Voyeurism Act of 2009",
        dialogue: "* Section 4(a) of Republic Act 9995, also known as the Anti-Photo or Voyeurism Act of 2009, is about taking photos or videos of a person performing sexual acts or their private areas without consent. This is very relevant to our case."
      },
      legal2: {
        title: "Section 4 of RA 11311",
        subtitle: "Safe Spaces Act",
        dialogue: "* Section 4 of RA 11311, the Safe Spaces Act, is about gender-based sexual harassment in public spaces. This aims to protect the citizens from sexual harassment in public spaces."
      },
      legal3: {
        title: "RA 10175",
        subtitle: "Cybercrime Prevention Act",
        dialogue: "* RA 10175, or the Cybercrime Prevention Act of 2012, criminalizes offenses committed through digital platforms, including hacking, identity theft, cybersex, and online libel."
      },
    };

    let dialogues = [];
    let currentDialoguePhase = 'narrator';

    const questions = [
      {// QUESTION 1
        preDialogues: [
          "JUDGE: Prosecution, before we hear your witness testimony, please establish the primary legal framework for this case.",
          "JUDGE: Under which Republic Act are you primarily prosecuting the defendant of  online harassment charges?"
        ],
        text: "Under which Republic Act and specific section are you prosecuting the gender-based online sexual harassment charges against Ms. Patricia Santos?",
        answers: [
          "Republic Act No. 10175 Section 4(c)(4) - Cyber Libel",
          "Republic Act No. 11313 Section 4 - Gender-based Online Sexual Harassment",
          "Republic Act No. 9995 Section 4(a) - Photo and Video Voyeurism",
          "Republic Act No. 7877 - Anti-Sexual Harassment Act"
        ],
        correct: 1,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! The prosecution is proceeding under Republic Act No. 11313, Section 4—Gender-based Online Sexual Harassment! It  covers unwelcome sexual comments, intimidation, also graphic material shared via social media such as Messenger, Instagram, or Facebook!\n\n★ YOU (PROSECUTOR): Both Chat Log Transcript Alpha and  Chat Log Transcript Beta showcase unwelcome, repeated sexual harassment directed at Maria via social platforms. The Safe Spaces Act exists expressly to fight this kind of online abuse targeting someone because of their gender! \n\n★ JUDGE: I see your point councilor, Its reasonable to say that Section 4 of RA11313 is indeed the primary charge.\n\n★ DEFENSE ATTORNEY: *grimaces* The prosecution knows their doing...\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, we're prosecuting under RA 10175, Section 4—Cyber Libel...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution misidentifies the primary charge! While RA 10175's cyber libel may apply to defamatory posts, the MAIN charges concern persistent sexual harassment through WhatsApp and Instagram with Chat Log Transcript Alpha and Chat Log Transcript Beta!\n\n✗ DEFENSE ATTORNEY: Those fall under RA 11313 Section 4, Gender-based Online Sexual Harassment! The prosecutor should know which law they're primarily using!\n\n✗ DEFENSE ATTORNEY: Your Honor, this shows fundamental confusion about the case structure!\n\n✗ JUDGE: Sustained. Prosecution, RA 11313 Section 4 governs the primary harassment charges. Cyber libel may be an additional count, but clarify your primary legal basis.",
          "✗ YOU (PROSECUTOR): Your Honor, we're prosecuting under RA 9995 Section 4(a)—Photo and Video Voyeurism...\n\n✗ DEFENSE ATTORNEY: HOLD IT! The prosecution is focusing on separate incidents! \n\n✗ DEFENSE ATTORNEY: Yes, RA 9995 applies to the CCTV Footage of NAIA Terminal 3  and the unauthorized picture. But the primary charges involve six months of online sexual harassment through messaging platforms! \n\n✗ DEFENSE ATTORNEY: That's RA 11313 Section 4! Chat Log Transcript Alpha and Chat Log Transcript Beta aren't photos that are under RA995 they're sexually explicit messages and persistent unwanted advances! The prosecutor seems confused about which law governs which conduct!\n\n✗ JUDGE: Sustained. Prosecution, distinguish between the voyeurism incident and the online harassment charges. RA 11313 Section 4 governs digital harassment.",
          "✗ YOU (PROSECUTOR): Got it,Your Honor, we're prosecuting under RA 7877—the Anti-Sexual Harassment Act..\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution cites an outdated law! RA 7877 from 1995 addresses workplace and educational sexual harassment, primarily physical conduct.\n\n✗ DEFENSE ATTORNEY: This was established way before anyone was posting online. The modern law for ONLINE gender-based harassment is RA 11313 Section 4, the Safe Spaces Act of 2019! \n\n✗ DEFENSE ATTORNEY: Chat Log Transcript Alpha and Chat Log Transcript Beta show Messenger and Instagram harassment—digital platforms that didn't exist when RA 7877 was written! The prosecutor should use the correct, applicable statute!\n\n✗ JUDGE: Sustained. RA 7877 establishes CODI requirements, but RA 11313 Section 4 specifically governs online harassment. Update your legal framework, Counselor."
        ]
      },
      { // QUESTION 2
        preDialogues: [
          "JUDGE: Prosecution, you've presented,CCTV Footage of NAIA Terminal 3 showing the defendant photographing under a woman's skirt.",
          "JUDGE: Under which specific provision are you charging this conduct?"
        ],
        text: "The  CCTV Footage of NAIA Terminal 3  shows CCTV footage of the defendant taking an upskirt photograph at NAIA. Under which specific section of RA 9995 is this conduct prohibited?",
        answers: [
          "Section 4(a) - Taking photos under a person's clothing without consent",
          "Section 3(a) - Photo voyeurism in private places",
          "Section 5 - Penalties for distribution of voyeuristic materials",
          "Section 6 - Venue and jurisdiction provisions"
        ],
        correct: 0,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor!  Section 4(a) of the Anti-Photo and Video Voyeurism Act explicitly prohibits taking photos or videos under a person's clothing without consent!\n\n★ YOU (PROSECUTOR): CCTV Footage of NAIA Terminal 3 's CCTV footage shows the defendant positioning his phone at an upward angle beneath the victim’s skirt at 2:15 PM. \n\n★ YOU (PROSECUTOR): And the photo itself proves it – its data matches the time of the incident exactly. Moreover, a similar prosecution happened right here, involving a Cebu City official, establishing this behavior breaks the law as outlined in Section 4—\n\n★ JUDGE: That’s spot on, Counsel, Section 4(a) is the applicable provision.\n\n★ DEFENSE ATTORNEY: *shuffles papers nervously* The evidence is... concerning..\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, this violates Section 3(a) regarding voyeurism in private places...\n\n✗ DEFENSE ATTORNEY: OBJECTION! That application of the law is way off. Section 3(a) specifically concerns itself with peeping into PRIVATE spaces like bathrooms or bedrooms.\n\n✗ DEFENSE ATTORNEY : But NAIA Terminal 3 is a PUBLIC airport! More importantly, the prosecutor misses the point. A more applicable law would be section 4(a) specifically prohibits photographing UNDER someone's CLOTHING, regardless of location!\n\n✗ DEFENSE ATTORNEY : Whether in a private location  or public airport,taking photos up someone’s skirt violates Section 4(a). The location doesn't determine the violation; the act of photographing under clothing does!\n\n✗ JUDGE: Sustained. Section 4(a) governs upskirt photography regardless of public or private setting.",
          "✗ YOU (PROSECUTOR): Your Honor, Section 5 on distribution penalties applies...\n\n✗ DEFENSE ATTORNEY: HOLD IT ! The prosecution charges distribution without proof the defendant did the offense!\n\n ✗ DEFENSE ATTORNEY:  the prosecution must first prove the photo was illegally OBTAINED under Section 4(a)! Digital Forensics Report shows the photo was found on my client's phone, but there's no evidence of distribution!\n\n✗ DEFENSE ATTORNEY: The prosecutor is charging the wrong section—Theyre focusing on the charge of distributing the photo not TAKING it!\n\n✗ JUDGE: Sustained. Establish the violation of Section 4(a)  for taking the photo first, Prosecution.",
          "✗ YOU (PROSECUTOR): Your Honor, Section 6 regarding venue and jurisdiction...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution is talking about paperwork, not guilt or innocence! Section 6 simply dictates where to bring a case; it doesn’t define the crime itself!\n\n✗ DEFENSE ATTORNEY:  CCTV Footage of NAIA Terminal 3  allegedly shows my client photographing under someone's clothing. That conduct, if proven, would violate Section 4(a)!\n\n✗ DEFENSE ATTORNEY : Venue provisions set where a trial happens - not what someone did. The prosecutor confuses procedure with content!\n\n✗ JUDGE: Sustained. Section 6 is about the venue, not the criminal prohibition itself. Section 4(a) defines the offense."
        ]
      },
      { // QUESTION 3
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, I call the defendant’s co-worker and the victim  Ms. Maria to the stand.",
          "(Ms. Maria approach the stand to take an oath)",
          "YOU (PROSECUTOR): So, Ms. Maria…",
          "YOU (PROSECUTOR): Because this person works with you, you first reported it to the company’s Committee on Decorum and Investigation rather than going straight to the police  is that correct?",
          "MS. MARIA: Yes, I followed the company's procedures first, not to get involved in some serious policy violation, if I disobeyed I might get fired.",
          "MS. MARIA: Which is bad for me since I’m building a great portfolio.",
          "DEFENSE ATTORNEY : Your Honor, what relevance does institutional policy have to criminal proceedings?"

        ],
        text: "Institutional Policy Document shows the employer's established harassment complaint procedures. Under RA 11313, what are employers and institutions REQUIRED to do regarding gender-based harassment?",

        answers: [
          "Simply post the law on bulletin boards",
          "Terminate accused employees upon any complaint",
          "Immediately report all complaints to police",
          "Establish policies,training and implement mechanisms like CODI to address complaints"
        ],
        correct: 3,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! presents Institutional Policy Document  RA 11313 doesn't just prohibit harassment—it REQUIRES institutional accountability\n\n★ YOU (PROSECUTOR): Employers and educational institutions must establish comprehensive policies, provide training to staff about gender-based harassment,\n\n★ YOU (PROSECUTOR): AND implement mechanisms like the Committee on Decorum and Investigation to receive and address complaints!\n\n★ YOU (PROSECUTOR): The Institutional Policy Document  shows the companies  followed the proper procedure  regarding Ms. Maria’s case.\n\n★ YOU (PROSECUTOR): Consequently, this indicates the situation wasn’t just a minor issue it needed looking into by authorities alongside the company itself.\n\n★ YOU (PROSECUTOR): The reference materials confirm institutions must create these systematic response mechanisms!\n\n★ JUDGE: Excellent explanation, Counselor. Institutional compliance strengthens your case.\n\n★ MS. MARIA: The company took it seriously, and so should this court.\n\n★ JUDGE: That is correct, let the eyes of everyone here be clear and our ears be none stopped\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, institutions just need to post the law on bulletin boards...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecution is making light of what organizations are supposed to do.\n\n✗ DEFENSE ATTORNEY : It isn’t enough to simply display notices, RA 11313 demands they actually do something.\n\n✗ DEFENSE ATTORNEY : Employers must establish policies, conduct training, and implement functional complaint mechanisms like CODI!\n\n✗ DEFENSE ATTORNEY : The Institutional Policy Document  shows Ms. Maria's employer created comprehensive procedures, not decorative wall displays!\n\n✗ DEFENSE ATTORNEY : If the prosecutor thinks posting a note satisfies institutional duties, they fundamentally misunderstand RA 11313's requirements!\n\n✗ DEFENSE ATTORNEY : Their grasp of the relevant laws seemed questionable.\n\n ✗ JUDGE: Sustained. Institutions must implement active systems, not passive displays. Study the statute more carefully, Prosecution.",
          "✗ YOU (PROSECUTOR): Your Honor, employers must terminate the accused employee immediately...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecution proposes violations of due process! Firing someon  based solely on accusations violates constitutional rights!\n\n✗ DEFENSE ATTORNEY : RA 11313 requires institutions to INVESTIGATE through mechanisms like CODI to collect proof, listin to everyone involved, make conclusions, THEN apply appropriate penalties which MIGHT include termination!\n\n✗ DEFENSE ATTORNEY : Institutional Policy Document shows proper procedure with investigation before action. The prosecutor's statement  would eliminate due process entirely!\n\n✗ JUDGE: Sustained. Due process requires investigation before sanction. Reconsider your understanding of institutional procedures, Counselor.",
          "✗ YOU (PROSECUTOR): Your Honor, employers must immediately report all incidents to police...\n\n✗ DEFENSE ATTORNEY : HOLD IT! The prosecution doesn't even know mandatory requirements!\n\n✗ DEFENSE ATTORNEY : RA 11313 requires institutions to establish internal investigation mechanisms like CODI to receive and investigate complaints.\n\n✗ DEFENSE ATTORNEY : Victims choose whether to pursue criminal charges separately! The Institutional Policy Document  shows proper procedure.\n\n✗ DEFENSE ATTORNEY : Ms. Maria filed with CODI, they investigated, then SHE decided to file criminal charges.\n\n✗ DEFENSE ATTORNEY : Not all harassment complaints warrant police involvement some require company action only. The prosecutor misunderstands what's the difference between institutional vs. criminal processes!\n\n✗ JUDGE: Sustained. Institutions investigate internally; victims decide whether to pursue criminal charges separately."
        ]
      },
      { // QUESTION 4
        questionType: 'evidence',
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, I direct the court's attention to Evidence: Chat Log Transcript Alpha dated March 15, 2025.",
          "The screen displays the text messages : \"You know you want me,\" \"I can't stop thinking about your body,\" \"Why are you ignoring me? I know you're attracted to me too.\"",
          "DEFENSE ATTORNEY: Your Honor, how do we know these messages came from my client?",
          "JUDGE: Prosecution, you must establish a connection between the texts and the defendant . What evidence proves these messages originated from the defendant?"
        ],
        text: "To conclusively prove that the messages in Chat Log Transcript Alpha were sent by the defendant, which piece of evidence must you present to establish the connection between the phone number (+63-917-5554-XXX) and Mr. Dwg?",
        correctEvidenceIds: ['evidence1', 'evidence6'],
        correctMsgs: {
          'evidence6': "★ YOU (PROSECUTOR): *present with confidence* Your Honor, I present Evidence 006:the Digital Forensics Report from the NBI Cybercrime Division, and Evidence 001:the Samsung Galaxy S21 registered to the defendant!\n\n★ YOU (PROSECUTOR): The Digital Forensics Report establishes a link between the text and defendant! It confirms: First, the phone number +63-917-5554-XXX is registered to Dwg under the SIM Registration.\n\n★ YOU (PROSECUTOR): Second, the Samsung Galaxy S21 device is registered to and owned by the defendant. Third, IP addresses and device metadata conclusively link this specific device to the messages in Chat Log Transcript Alpha. \n\n★ YOU (PROSECUTOR): Lastly, forensic analysis verified the Messenger application on this phone sent these exact messages on March 15, 2025! The defendant's digital fingerprint is all over this evidence!\n\n★ JUDGE: The connection  is established. The messages are linked to the defendant through SIM registration, device ownership, and forensic analysis.\n\n★ DEFENSE ATTORNEY: *frustrated* The attribution... is solid, your honor.\n\n",
          'evidence1': "★ YOU (PROSECUTOR): *present with confidence* Your Honor, I present Evidence 006:the Digital Forensics Report from the NBI Cybercrime Division, and Evidence 001:the Samsung Galaxy S21 registered to the defendant!\n\n★ YOU (PROSECUTOR): The Digital Forensics Report establishes a link between the text and defendant! It confirms: First, the phone number +63-917-5554-XXX is registered to Dwg under the SIM Registration.\n\n★ YOU (PROSECUTOR): Second, the Samsung Galaxy S21 device is registered to and owned by the defendant. Third, IP addresses and device metadata conclusively link this specific device to the messages in Chat Log Transcript Alpha. \n\n★ YOU (PROSECUTOR): Lastly, forensic analysis verified the Messenger application on this phone sent these exact messages on March 15, 2025! The defendant's digital fingerprint is all over this evidence!\n\n★ JUDGE: The connection  is established. The messages are linked to the defendant through SIM registration, device ownership, and forensic analysis.\n\n★ DEFENSE ATTORNEY: *frustrated* The attribution... is solid, your honor.\n\n"
        },
        wrongMsgs: {
          'evidence2': "✗ YOU (PROSECUTOR): Your Honor, I present  the Chat Log Transcript Alpha itself, which shows the messages…\n\n✗ DEFENSE ATTORNEY: OBJECTION! This is just circular reasoning, Your Honor! The prosecution is trying to prove the messages came from my client by presenting the messages themselves! \n\n✗ DEFENSE ATTORNEY: Chat Log Transcript Alpha shows WHAT was said, but not WHO said it! That's precisely what I'm asking! the Digital Forensics Report, or the defendant's registered phone, would establish a link through SIM Registration records, device metadata, and forensic analysis! \n\n✗ DEFENSE ATTORNEY: The prosecutor is basically saying 'These messages prove that the message itself came from my client!' Absurd!\n\n✗ JUDGE: Sustained. You cannot prove attribution by presenting the very evidence whose origin is being questioned. Present evidence that LINKS the messages to the defendant.\n\n",
          'evidence3': "✗ YOU (PROSECUTOR): Your Honor, I present Chat Log Transcript Beta.\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents the WRONG chat history! Chat Log Transcript Beta contains Instagram DMs from March 20-April 10. The question concerns: \n\n✗ DEFENSE ATTORNEY: Messenger messages from March 15! Even if we accept that the defendant sent the Instagram messages , that doesn't establish that they sent Chat Log Transcript Alpha! \n\n✗ DEFENSE ATTORNEY: These are different platforms, different dates, different message history !  The Digital Forensics Report, establishes a connection for ALL platforms through comprehensive forensic analysis!  It seems the prosecution struggles to grasp its own evidences’ meaning.\n\n✗ JUDGE: Sustained. You're presenting a different set of messages entirely. Address the specific evidence in question.",
          'evidence4': "✗ YOU (PROSECUTOR): Your Honor, the CCTV footage and photograph prove attribution of the messages…\n\n✗ DEFENSE ATTORNEY: HOLD IT! The prosecution presents evidence from a separate event entirely!The CCTV Footage of NAIA Terminal 3 and the unauthorized picture concern the February 8 voyeurism incident at NAIA a separate crime! \n\n✗ DEFENSE ATTORNEY: The question asks about connection of  the March 15 Messenger messages! These are different dates, different violations, different evidence! The Digital Forensics Report, analyzes the phone and accounts used for electronic harassment! \n\n✗ DEFENSE ATTORNEY: The prosecutor apparently thinks footage of one crime proves attribution for a completely different crime!\n\n✗ JUDGE: Sustained. You're presenting evidence from an unrelated incident. Focus on attributing the electronic messages in question.\n\n",
          'evidence5': "✗ YOU (PROSECUTOR): Your Honor, the CCTV footage and photograph prove attribution of the messages…\n\n✗ DEFENSE ATTORNEY: HOLD IT! The prosecution presents evidence from a separate event entirely!The CCTV Footage of NAIA Terminal 3 and the unauthorized picture concern the February 8 voyeurism incident at NAIA a separate crime! \n\n✗ DEFENSE ATTORNEY: The question asks about connection of  the March 15 Messenger messages! These are different dates, different violations, different evidence! The Digital Forensics Report, analyzes the phone and accounts used for electronic harassment! \n\n✗ DEFENSE ATTORNEY: The prosecutor apparently thinks footage of one crime proves attribution for a completely different crime!\n\n✗ JUDGE: Sustained. You're presenting evidence from an unrelated incident. Focus on attributing the electronic messages in question.\n\n",
          'evidence7': "✗ YOU (PROSECUTOR): Your Honor, the victim's statement confirms these came from the defendant…\n\n✗  DEFENSE ATTORNEY: OBJECTION! The prosecution offers the  victim testimony as proof of that the defendant was the  owner of the account! Your Honor, the Victim's Account contains Ms. Maria's subjective account of receiving harassing messages.\n\n✗  DEFENSE ATTORNEY: But the question demands TECHNICAL PROOF of WHO sent them! The Digital Forensics Report from NBI Cybercrime Division, provides objective technical analysis: \n\n✗  DEFENSE ATTORNEY: SIM Registration records, IP addresses, device metadata, and forensic verification! The victim can testify she RECEIVED messages; only forensics can prove WHO SENT them! The  prosecution mixes what someone recalls seeing alongside hard evidence!\n\n✗  JUDGE: Sustained. Victim testimony establishes receipt and impact; forensic analysis establishes origin and attribution. Present technical evidence.",
          'evidence8': "✗ YOU (PROSECUTOR): Your Honor, the Facebook post proves who sent the messages…\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents evidence from a DIFFERENT form of communication and DIFFERENT date! The screenshot of  the Public Facebook Post  is a May 2 Facebook post—the question concerns March 15 Messenger messages! \n\n✗ DEFENSE ATTORNEY: Even if the Facebook post came from the defendant, that doesn't technically establish an association with the Messenger messages unless it's clear they’re the same account! \n\n✗ DEFENSE ATTORNEY: The Digital Forensics Report, provides comprehensive forensic analysis linking the defendant to ALL platforms through device metadata, IP addresses, and SIM Registration! \n\n✗ DEFENSE ATTORNEY: The prosecution is presenting bits of a  social media posts when technical forensics would conclusively establish a relation!\n\n✗ JUDGE: Sustained. A Facebook post from May doesn't establish any relation for Messenger messages from March. Present comprehensive attribution evidence.\n\n",
          'evidence9': "✗ YOU (PROSECUTOR): Your Honor, the institutional policy document proves attribution…\n\n✗ DEFENSE ATTORNEY: Hold it! The prosecution has completely gone off track! The Institutional Policy Document concerns workplace CODI procedures and institutional compliance with RA 11313! \n\n✗ DEFENSE ATTORNEY: How does an employer's harassment policy prove WHO sent electronic messages?The Digital Forensics Report, establishes attribution through SIM Registration records, device metadata, and forensic analysis! \n\n✗ DEFENSE ATTORNEY: When pressed to pinpoint who did what, the prosecutor instead showed how the system was supposed to work – a total shift in focus! It’s like answering a question about fingerprints with a description of security protocols.\n\n✗ JUDGE: Sustained. Institutional policies have nothing to do with proving who sent these messages. Present relevant evidence.\n\n",
          'evidence10': "✗ YOU (PROSECUTOR): Your Honor, the psychological report establishes the messages came from the defendant…\n\n✗ DEFENSE ATTORNEY: OBJECTION! That has absolutely nothing to do with who sent those messages! The Expert Psychological Report documents the psychological HARM the harassment caused Ms. Maria—it's about IMPACT, not ORIGIN! \n\n✗ DEFENSE ATTORNEY: The psychologist assessed anxiety and trauma, not phone records and IP addresses! The Digital Forensics Report, establishes WHO sent the messages through technical analysis! \n\n✗ DEFENSE ATTORNEY:The Expert Psychological Report establishes what those messages DID to the victim!  However, the prosecution  mixes up judging the damage with deciding who caused it.\n\n✗ JUDGE: Sustained. Psychological reports prove impact, not attribution. Stay focused on what the question asks.\n\n"
        },
        defaultWrongMsg: "✗ DEFENSE ATTORNEY: Objection! That evidence doesn't directly prove WHO sent the messages!\n\n✗ DEFENSE ATTORNEY: Your Honor, while the prosecution's selected evidence may be relevant, it doesn't establish the attribution we need!\n\n✗ JUDGE: Sustained. Prosecution, select evidence that directly proves the defendant sent these specific messages.\n\n✗ Credibility Score: -5"
      },
      { // QUESTION 5
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, Chat Log Transcript Beta reveals a disturbing pattern—47 Instagram messages over 21 days.",
          "(The screen shows messages including: \"You're so sexy in your stories,\" \"I deserve a chance,\" \"Don't be cold to me\")",
          "YOU (PROSECUTOR): Ms. Maria, did you respond to these messages?",
          "MS. MARIA: On March 23, I clearly told her: \"Please stop contacting me.\" But he kept sending messages for 18 more days even  after I asked him to stop.",
          "DEFENSE ATTORNEY : Your Honor, my client was merely expressing romantic interest!",
          "JUDGE: Prosecution, address the defense's claim."
        ],
        text: "Chat Log Transcript Beta shows 47 messages sent over 21 days, with 34 messages sent AFTER the victim explicitly said \"Please stop contacting me\" on March 23. What does this pattern establish under RA 11313?",
        answers: [
          "Mutual romantic interest requiring no legal intervention",
          "Persistent and systematic gender-based online harassment showing deliberate disregard for boundaries",
          "Protected freedom of expression under the Constitution",
          "Simple miscommunication that doesn't constitute harassment"
        ],
        correct: 1,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! *slams desk* This is NOT romance—this is SYSTEMATIC HARASSMENT!\n\n★ YOU (PROSECUTOR): Chat Log Transcript Beta shows the victim stated 'Please stop contacting me' on March 23, a clear, unambiguous rejection! Yet the defendant sent 34 MORE messages over 18 days!\n\n★ YOU (PROSECUTOR): Section 4 of RA 11313 makes it clear this behavior is forbidden: persistent unwanted sexual advances that deliberately violate the victims boundaries!\n\n★ YOU (PROSECUTOR): the psychological report, confirms Ms. Maria developed anxiety and sleep disturbances from this constant barrage! This is textbook gender-based online harassment!\n\n★ JUDGE: Powerfully argued, Counselor. The pattern demonstrates systematic violation of boundaries.\n\n★ MS. MARIA: *emotionally* he wouldn't stop, no matter what I said.\n\n★ DEFENSE ATTORNEY : *sits down quietly*\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, this could be interpreted as mutual romantic interest...\n\n✗ DEFENSE ATTORNEY : Your Honor, even the PROSECUTION admits this appears mutual! If the prosecutor themselves sees romantic interest rather than harassment, how can they prove criminal charges?\n\n✗ DEFENSE ATTORNEY : This admission destroys their own case! Chat Log Transcript Beta clearly shows my client's messages were unwanted, but the prosecutor just characterized them as mutual!\n\n✗ DEFENSE ATTORNEY : The prosecutor doesn't believe in their own charges!\n\n✗ JUDGE: Prosecution, you're arguing against your own case! Chat Log Transcript Beta shows explicit rejection followed by persistent contact.\n\n✗ JUDGE: That's harassment, not mutual interest. Reconsider your position immediately.\n\n✗ Ms. Maria: *looks betrayed* I said \"please stop\"... how is that mutual?",
          "✗ YOU (PROSECUTOR): Your Honor, these messages might be protected freedom of expression...\n\n✗ DEFENSE ATTORNEY : Your Honor, the PROSECUTION is making my argument for me! \n\n✗ DEFENSE ATTORNEY : If the prosecutor believes these messages are constitutionally protected speech, why are they prosecuting my client? \n\n ✗ DEFENSE ATTORNEY : This is preposterous —the prosecutor admits the conduct they're charging is legally protected! \n\n✗ DEFENSE ATTORNEY : Either they're clueless about constitutional law, or they're bringing charges they know are meritless! This seriously damages their credibility!\n\n✗ JUDGE: Prosecution! Are you defending or prosecuting? Freedom of expression doesn't protect harassment after explicit rejection. \n\n✗ JUDGE: 34 messages following \"please stop\" is not protected speech—it's criminal conduct under RA 11313!\n\n✗ MS. MARIA: confused Whose side are you on?",
          "✗ YOU (PROSECUTOR): Your Honor, this seems like miscommunication...\n\n✗ DEFENSE ATTORNEY : Your Honor, the PROSECUTION calls their own case a \"miscommunication\"! If the prosecutor doesn't believe this is criminal harassment, why are we in court? \n\n✗ DEFENSE ATTORNEY : They're essentially agreeing with the defense! \”Please stop contacting me\” followed by 34 ignored messages isn't miscommunication—but the prosecutor just said it is! \n\n✗ DEFENSE ATTORNEY : This prosecutor either doesn't understand their own case or doesn't believe in it!\n\n✗ JUDGE: Prosecution, you're sabotaging your own case! \"Please stop contacting me\" is crystal clear—not a miscommunication! \n\n✗ JUDGE: 34 subsequent messages demonstrate deliberate harassment. If you don't believe in your own charges, dismiss them!\n\n✗ Ms. Maria: *standing* What was unclear about \"please stop\"?!"
        ]
      },

      { // QUESTION 6
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, I now present a Screenshot of a Public Facebook Post from May 2, 2025.",
          "(The screen displays: \"Maria is secretly gay but pretends to be straight to get women. I have proof he's been lying to everyone.\")",
          "YOU (PROSECUTOR): This post was shared 847 times, reaching 47,000 people before removal.",
          "DEFENSE ATTORNEY : Objection! What does this have to do with harassment? This is simply my client expressing an opinion!",
          "JUDGE: Prosecution, explain what additional legal violation this post constitutes beyond the harassment charges."
        ],
        text: "Screenshot of Public Facebook Post contains false statements about the victim's sexual orientation posted publicly with apparent defamatory intent, reaching 47,000 people. What additional violation does this constitute?",
        answers: [
          "Copyright infringement under RA 8293",
          "Data Privacy violations under RA 10173",
          "Cyber libel under Section 4of RA 10175 (Cybercrime Prevention Act)",
          "Consumer fraud under RA 7394"
        ],
        correct: 2,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! *presents evidence forcefully* This transcends harassment—it's CYBER LIBEL under Section 4 of RA 10175! \n\n★ YOU (PROSECUTOR): The defendant made specific FALSE factual claims about Ms. Maria's sexual orientation, stating \“I have proof\” when Digital Forensics Report 's results found NO such proof on his devices! \n\n★ YOU (PROSECUTOR): He published this defamatory content to 47,000 people through Facebook that's defamation amplified by digital means! The prosecution is charging BOTH RA 11313 harassment AND RA 10175 cyber libel. \n\n★ JUDGE: That’s spot on, Counsel, We’ll add cyber libel to the list.\n\n★ MS.MARIA: tearfully That post destroyed my reputation with everyone I know.\n\n★ DEFENSE ATTORNEY : frowns The layering of charges is... legally sound.\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, this violates copyright law under RA 8293...\n\nOBJECTION! The prosecutor confuses defamation with intellectual property! Copyright protects creative works like books, music, and art from unauthorized copying! \n\n✗ DEFENSE ATTORNEY :  Screenshot of Public Facebook Post contains FALSE STATEMENTS about my client making defamatory claims about someone's sexual orientation! There's no copyrighted work here! \n\n✗ DEFENSE ATTORNEY :  The prosecution muddling copyright with cyber  libel? A glaring sign of incompetence, really - it throws their whole argument into question\n\n✗ JUDGE: Sustained. Copyright and defamation are entirely different legal areas. If you're charging this post, it would be cyber libel under RA 10175, not copyright infringement. This is a fundamental error, Counselor.\n\n✗ Ms. Maria: *confused* How is a post about me related to copyright?",
          "✗ YOU (PROSECUTOR): Your Honor, this violates data privacy under RA 10173...\n\n✗ DEFENSE ATTORNEY :  OBJECTION! The prosecutor misunderstands data privacy law! RA 10173 is about  unauthorized COLLECTION, PROCESSING, or DISCLOSURE of personal data by organizations and institutions! \n\n✗ DEFENSE ATTORNEY :  The screenshot of the  public Facebook post shows my client making FALSE PUBLIC STATEMENTS, that's defamation, not data privacy violation! \n\n✗ DEFENSE ATTORNEY : He didn't hack a database or process collected information,He just posted a lie on Facebook!  \“The prosecution believing this is a breach of data security shows how little they understand the law\”.\n\n✗ JUDGE: Sustained. Data privacy law governs data handling by organizations, not false public statements by individuals. \n\n✗ JUDGE: This is cyber libel under RA 10175, Counselor. Know the difference.",
          "✗ YOU (PROSECUTOR): Your Honor, this constitutes consumer fraud under RA 7394...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecutor is using rules for businesses when this is about someone’s reputation! \n\n✗ DEFENSE ATTORNEY : Consumer protection law addresses fraudulent business practice lille false advertising, defective products, deceptive sales! \n\n✗ DEFENSE ATTORNEY :  The screenshot of the public Facebook post shows a Facebook post making false claims about someone's sexual orientation! \n\n✗ DEFENSE ATTORNEY : There's no commercial transaction, no product, no consumer relationship!\n\n✗ DEFENSE ATTORNEY : If the prosecutor thinks a defamatory social media post is consumer fraud, It shows a startling lack of grasp on law itself – frankly, it’s quite shocking.\n\n✗ JUDGE: Sustained. Consumer protection law governs commercial transactions, not personal defamation on social media. \n\n✗ JUDGE: This error suggests serious gaps in your legal knowledge, Prosecution.\n\n✗ Ms. Maria: frustrated How is what he said about me related to consumer products?"
        ]
      },
      { // QUESTION 7
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, I present the NBI Cybercrime Division's comprehensive Digital Forensics Report.",
          "(A thick technical document is displayed showing IP addresses, device metadata, EXIF data, and account ownership analysis.)",
          "DEFENSE ATTORNEY : Your Honor, this is just technical jargon! What does it actually prove?",
          "JUDGE: Prosecution, explain the legal purpose of this forensic evidence in your case."
        ],
        text: "Digital Forensics Report  confirms IP addresses, device metadata, EXIF data, and account ownership linking all harassing content to the defendant. What is the primary legal purpose of this forensic evidence?",
        answers: [
          "To demonstrate the defendant's advanced technical sophistication",
          "To establish identity and attributability—proving the defendant personally committed the acts",
          "To calculate monetary value of devices for damages",
          " To prove the victim's lack of technical knowledge"
        ],
        correct: 1,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! presents report decisively Digital Forensics Report  serves one critical purpose:\n\n★ YOU (PROSECUTOR): ATTRIBUTION! In cybercrime prosecution, defendants often claim 'someone else used my account' or 'my phone was stolen.' This 47-page forensic analysis eliminates such defenses!\n\n ★ YOU (PROSECUTOR): The NBI Cybercrime Division confirmed that the Samsung Galaxy S21 registered to Dwg sent Chat Log Transcript Alpha's Messenger messages and that HIS Instagram account sent Chat Log Transcript Beta's DMs,\n\n ★ YOU (PROSECUTOR): that HIS Facebook account posted the Screenshot of the  Public Facebook Post, and that HIS phone's camera captured the unauthorized picture at the exact time shown in CCTV Footage of NAIA Terminal 3!\n\n ★ YOU (PROSECUTOR): This evidence proves HE committed these acts!\n\n★ JUDGE: Excellently articulated, Counselor. Attribution is indeed the foundation of cybercrime prosecution.\n\n★ MS. MARIA: The forensics prove it was definitely his.\n\n★ DEFENSE ATTORNEY : reluctantly nods The attribution evidence is... thorough.\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, this forensic report demonstrates the defendant's technical sophistication...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecution misses the entire point of forensic evidence! Technical skill is irrelevant to guilt! \n\n✗ DEFENSE ATTORNEY : Whether my client is a computer genius or technologically illiterate doesn't prove if he committed these acts! \n\n✗ DEFENSE ATTORNEY : The digital forensics report  exists to prove IDENTITY—that HE sent the messages, posted the content and took the photos! \n\n✗ DEFENSE ATTORNEY : The prosecutor's focus on being  'skilled ' suggests they don't understand what digital forensics actually accomplish in cybercrime cases! This undermines their credibility! \n\n✗ JUDGE: Sustained. Forensics establishes who committed the acts, not their technical skill level. Focus on attribution, Counselor. \n\n✗ Ms. Maria: Whether he's tech-savvy doesn't matter—did he do it or not? \n\n",
          "✗ YOU (PROSECUTOR): Your Honor, the forensics calculate device values for damages...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecutor is cataloging gadgets instead of investigating a crime! That report maps what happened, it doesn’t list costs.\n\n✗ DEFENSE ATTORNEY : The report analyzes IP addresses, app data, account ownership to prove my client committed these acts! Device value is irrelevant to criminal prosecution! \n\n✗ DEFENSE ATTORNEY : If the prosecutor thinks forensics are about property appraisal rather than criminal attribution, they fundamentally misunderstand digital evidence! A worrying sign of inadequacy, to say the least.\n\n✗ JUDGE: Sustained. Criminal forensics prove identity and criminal acts, not property values. This is a serious misunderstanding, Prosecution.\n\n",
          "✗ YOU (PROSECUTOR): Your Honor, this report demonstrates the victim's technological vulnerabilities...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecution victim-blames through digital evidence! Digital Forensics Report  analyzes the DEFENDANT'S devices and accounts, not the victim's! \n\n✗ DEFENSE ATTORNEY : The forensics examine HIS phone, HIS social media, HIS digital footprint to prove He committed harassment! Ms. Maria's technical knowledge is completely irrelevant! \n\n✗ DEFENSE ATTORNEY : Even if he were a cybersecurity expert, harassment would still be criminal! Its concerning that the prosecution is focused on what the victim did - or didn’t do - rather than holding the accused responsible \n\n✗ JUDGE: Sustained. Forensics establish defendant's actions, not victim's vulnerabilities. This victim-blaming approach is inappropriate, Counselor. \n\n✗ MS. MARIA: *angry* Are you seriously blaming ME for his harassment?"
        ]
      },

      { // QUESTION 8
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, I now present an expert psychological report of the psychological impact assessment.",
          "(The screen displays excerpts: \"Patient presents with symptoms consistent with anxiety disorder directly attributable to sustained online harassment. Sleep disturbances, hypervigilance, workplace performance decline, and social withdrawal documented.\")",
          "DEFENSE ATTORNEY : Your Honor, these are just emotional complaints! Real harm requires physical injury!",
          "JUDGE: Prosecution, address the defense's argument about psychological harm."
        ],
        text: " Expert Psychological Report documents Ms. Maria's anxiety, sleep disturbances, and workplace decline caused by the harassment. Under RA 11313 and related laws, what role does proof of psychological harm play?",
        answers: [
          "Psychological harm is irrelevant; only physical injury matters",
          "Psychological harm establishes severity and impact, supporting both prosecution and damages",
          "Victims must prove permanent psychological disability for prosecution",
          "Psychological reports are inadmissible hearsay"
        ],
        correct: 1,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! *presents report passionately*  this expert report details real harm to the victims psyche. ! RA 11313 explicitly protects against harassment causing psychological and emotional distress! \n\n★ YOU (PROSECUTOR): This licensed psychologist's assessment documents clinical anxiety disorder, sleep disturbances, and workplace performance decline; those are measurable, serious impacts! \n\n★ YOU (PROSECUTOR): This evidence serves dual purposes: it demonstrates the SEVERITY of the harassment for criminal prosecution, proving this wasn't harmless contact, AND it provides foundation for civil damages! \n\n★ YOU (PROSECUTOR):  The Philippine law recognizes psychological trauma as REAL harm deserving legal protection! \n\n★ JUDGE: Powerfully stated, Counselor. Psychological harm is both real and legally cognizable.\n\n★ MS. MARIA: *emotionally* He destroyed my mental health for months. \n\n★ DEFENSE ATTORNEY : *quietly* The harm is quite documented. \n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, I agree psychological harm is less important than physical injury…\n\n✗ DEFENSE ATTORNEY : Your Honor, the PROSECUTION just agreed with my argument! They said that emotional distress doesn’t matter unless someone’s physically hurt  which basically destroys what they’re trying to prove!\n\n✗ DEFENSE ATTORNEY : Expert Psychological Report is THEIR evidence showing psychological damage! Are they saying their own evidence doesn't matter? \n\n✗ DEFENSE ATTORNEY : This is extraordinary, the prosecutor doesn't believe in the harm their own victim suffered! \n\n✗ DEFENSE ATTORNEY : How can they prosecute a case they don't believe in?\n\n✗ JUDGE: Prosecution! Are you representing the victim or defending the accused? RA 11313 explicitly protects against psychological and emotional harm! \n\n✗ JUDGE: You just sabotaged your own case by agreeing with the defense. Modern Philippine law recognizes psychological harm as serious injury!\n\n✗ MS. MARIA: *shocked* You're saying what he did to my mental health doesn't matter?\n\n",
          "✗ YOU (PROSECUTOR): Your Honor, the victim must prove permanent psychological disability…\n\n✗ DEFENSE ATTORNEY : Your Honor, the PROSECUTION creates impossible standards that would kill harassment laws! If permanent disability were required, people could be abused into  almost having serious injury without consequence.\n\n✗ DEFENSE ATTORNEY : RA 11313 protects against unwanted harassment REGARDLESS of injury severity! Expert Psychological Report shows serious harm, but even then the act of harassing someone is still unlawful even without proof of emotional damage.\n\n✗ DEFENSE ATTORNEY : The prosecutor's position would let my client harass people freely as long as he doesn't permanently disable them! This is absurd!\n\n✗ JUDGE: Sustained. Harassment is criminal based on the conduct, not severity of resulting harm. The psychological evidence aggravates but doesn't enable prosecution. You've misunderstood the law, Counselor.\n\nMS. MARIA: So he could have kept harassing me as long as I didn't break completely?",
          "✗ YOU (PROSECUTOR): Your Honor, actually this psychological report might be inadmissible hearsay…\n\n✗ DEFENSE ATTORNEY : With respect, your Honor,the prosecution now doubts its own proof! If they don't believe their expert psychological report is admissible, why did they present it? \n\n✗ DEFENSE ATTORNEY : Expert testimony from licensed professionals who personally examined patients is TEXTBOOK admissible evidence! The prosecutor either doesn't understand legal standards  or is so confused they're attacking their own exhibits! \n\n✗ DEFENSE ATTORNEY : This is professional incompetence on display!\n\n✗ JUDGE: Prosecution! You presented this evidence, and now you're claiming it's inadmissible hearsay? \n\n✗ JUDGE: Expert psychological assessments are clearly admissible under Philippine evidence rules! Are you trying to lose this case? Get your arguments straight!\n\n✗ MS. MARIA: *bewildered* You brought this evidence and now you're saying it shouldn't be allowed?"
        ]
      },

      { // QUESTION 9
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, the initial upskirt photography incident at NAIA occurred on February 8, 2025. The victim, Maria, initially filed her complaint with the Lapu-Lapu City Prosecutor's Office, which dismissed it for lack of jurisdiction.",
          "YOU (PROSECUTOR): She then successfully filed with the Pasay City Prosecutor's Office, which we are prosecuting today.",
          "DEFENSE ATTORNEY : Your Honor, why is the venue even relevant? It feels like they’re stretching for something here!",
          "JUDGE: Prosecution, explain why jurisdiction was properly established in Pasay City."
        ],

        text: " The upskirt photography incident at NAIA was initially filed in Lapu-Lapu City but dismissed for lack of jurisdiction, then properly filed in Pasay City. Why does Pasay City have proper jurisdiction?",
        answers: [
          "Because the victim was traveling to Cebu",
          "Because all cybercrime cases must be filed in Metro Manila",
          "Because the crime occurred  within Pasay City's territorial jurisdiction",
          "Because the defendant resides in Pasay City"
        ],
        correct: 2,
        correctMsg: "★ YOU (PROSECUTOR): Your Honor! presents jurisdictional argument Territorial jurisdiction is fundamental criminal procedure! The crime must be prosecuted where it OCCURRED! \n\n★ YOU (PROSECUTOR): CCTV Footage of NAIA Terminal 3 's CCTV footage clearly shows its location 'NAIA Terminal 3, Pasay City’!\n\n★ YOU (PROSECUTOR): The upskirt photography happened within Pasay City's territorial boundaries, establishing that the case belongs here!\n\n★ YOU (PROSECUTOR): The Lapu-Lapu City Prosecutor was right to dismiss it for lack of jurisdiction because the crime didn't occur in their territory.\n\n★ YOU (PROSECUTOR): The victim's destination and defendant's residence are irrelevant. The criminal act occurred in Pasay City, so Pasay City will handle this case!\n\n★ JUDGE: Correctly argued, Counselor. Territorial jurisdiction follows the locus criminis.\n\n★ DEFENSE ATTORNEY : *grudgingly* The venue is proper....\n\n★ Credibility Score: +5",
        wrongMsgs: [
          "✗ YOU (PROSECUTOR): Your Honor, Pasay has jurisdiction because the victim was traveling to Cebu...\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecution invents venue rules based on travel plans! Territorial jurisdiction depends on where crimes OCCUR, not where victims are GOING! \n\n✗ DEFENSE ATTORNEY : If the prosecutor's logic held, every crime against a traveler could be prosecuted in their destination city!   CCTV Footage of NAIA Terminal 3  shows the crime at NAIA Terminal 3 in PASAY CITY—that's why Pasay has jurisdiction!  \n\n✗ DEFENSE ATTORNEY : The victim's Cebu destination is completely irrelevant! This prosecutor doesn't understand basic criminal procedure! \n\n✗ JUDGE: Sustained. Victim destination doesn't establish jurisdiction. The crime location does—NAIA in Pasay City. \n\n",
          "✗ YOU (PROSECUTOR): Your Honor, all cybercrime cases must be filed in Metro Manila…\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecutor is making up rules about where this case should be heard. First, this isn't mainly a cybercrime, it's VOYEURISM under RA 9995! \n\n✗ DEFENSE ATTORNEY : Second, even so,  cybercrimes aren't all filed in Manila! Territorial jurisdiction applies to all crimes!  The CCTV Footage of NAIA Terminal 3  shows a physical act—upskirt photography—at NAIA Terminal 3 in Pasay. \n\n✗ DEFENSE ATTORNEY : The crime occurred in Pasay City's territory, so Pasay City is the one who will handle the case ! \n\n✗ DEFENSE ATTORNEY : There's no magical rule funneling cases to Manila! This prosecutor fundamentally misunderstands Philippine jurisdiction! \n\n✗ JUDGE: Sustained. No such blanket Manila jurisdiction exists. Basic territorial principles apply.",
          "✗ YOU (PROSECUTOR): Your Honor, jurisdiction lies in Pasay because the defendant lives there…\n\n✗ DEFENSE ATTORNEY : OBJECTION! The prosecution confuses defendant residence with crime location! If residence determined jurisdiction, criminals could choose their trial locations by moving! Territorial jurisdiction is based on where crimes OCCUR!  \n\n✗ DEFENSE ATTORNEY :  The CCTV Footage of NAIA Terminal 3  shows the crime at NAIA Terminal 3 in Pasay City, that establishes venue, not where MR. Dwg lives!\n\n✗ DEFENSE ATTORNEY : The prosecutor's logic would let people simply move around to find a court they prefer?  This is a fundamental criminal procedure that the prosecutor apparently doesn't grasp! \n\n✗ JUDGE: Sustained. Crime location establishes jurisdiction, not defendant residence. This is basic procedure, Counselor."
        ]
      },
      { // QUESTION 10
        questionType: 'evidence',
        preDialogues: [
          "YOU (PROSECUTOR): Your Honor, we approach the end of this case. The prosecution has presented overwhelming evidence: The CCTV footage, digital forensics, chat logs, psychological assessments, and institutional documentation.",
          "JUDGE: Prosecution, you've presented evidence spanning multiple incidents, multiple Republic Acts, and systematic harassment. For your final presentation, demonstrate how institutional mechanisms properly addressed these complaints before criminal prosecution."
        ],
        text: "The prosecution has shown a pattern of gender-based harassment across multiple victims and platforms. Which piece of evidence BEST demonstrates that proper institutional procedures were followed before bringing criminal charges, showing the systematic and appropriate response to harassment complaints?",
        correctEvidenceIds: ['evidence9'],
        correctMsgs: {
          'evidence9': "★ YOU (PROSECUTOR): *stands and presents with authority* Your Honor, I present the Institutional Policy Document! This proves Ms. Maria followed proper procedure!\n\n★ YOU (PROSECUTOR): Before bringing criminal charges, she filed with her employer's Committee on Decorum and Investigation as stated by RA 11313 and RA 7877! This document shows the employer established comprehensive policies, provided training about gender-based harassment, and implemented investigation mechanisms!\n\n★ YOU (PROSECUTOR): The CODI investigated, gathered evidence, provided due process, and determined the harassment warranted both administrative action AND criminal referral!\n\n★ YOU (PROSECUTOR): The abuse went so far that every internal option was tried prior to involving law enforcement. It shows the process functioned correctly.\n\n★ JUDGE: Excellent final presentation, Counselor. The Institutional Policy Document demonstrates proper institutional response and the seriousness warranting criminal charges.\n\n★ MS. MARIA: I ensure that all procedures were observed upon appearing to court.\n\n★ DEFENSE ATTORNEY: *reluctantly* The institutional procedure was... properly followed with no loopholes. Very good."
        },
        wrongMsgs: {
          'evidence1': "✗ YOU (PROSECUTOR): Your Honor, I present the defendant's phone...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution shows us the TOOL of harassment, not proof of proper procedures! Evidence 001 proves WHO harassed, not that institutional policies were followed!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document demonstrates CODI procedures were properly executed before criminal charges! The prosecutor confuses evidence types!\n\n✗ JUDGE: Sustained. Show evidence of institutional compliance, not the devices used in the crime.",
          'evidence2': "✗ YOU (PROSECUTOR): Your Honor, Chat Log Transcript Alpha shows...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents harassment evidence instead of procedural compliance! Chat Log Transcript Alpha demonstrates the CRIME, not that proper institutional mechanisms were followed!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document shows the employer's CODI investigation and compliance with RA 11313 requirements!\n\n✗ JUDGE: Sustained. We need evidence of institutional procedure, not the harassment itself.",
          'evidence3': "✗ YOU (PROSECUTOR): Your Honor, Chat Log Transcript Beta demonstrates...\n\n✗ DEFENSE ATTORNEY: OBJECTION! More harassment evidence when we need procedural proof! Chat Log Transcript Beta shows persistent harassment, not institutional compliance!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document demonstrates proper CODI procedures were followed!\n\n✗ JUDGE: Sustained. Present evidence of institutional response, not the underlying harassment.",
          'evidence4': "✗ YOU (PROSECUTOR): Your Honor, the CCTV footage...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents voyeurism evidence instead of procedural documentation! CCTV Footage shows a CRIME, not institutional compliance!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document proves proper procedures were followed!\n\n✗ JUDGE: Sustained. We need proof of proper institutional handling, not crime footage.",
          'evidence5': "✗ YOU (PROSECUTOR): Your Honor, the unauthorized picture...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution shows the RESULT of voyeurism, not procedural compliance! The unauthorized picture is crime evidence, not proof of institutional response!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document demonstrates proper CODI procedures!\n\n✗ JUDGE: Sustained. Present institutional compliance evidence, not crime evidence.",
          'evidence6': "✗ YOU (PROSECUTOR): Your Honor, the Digital Forensics Report...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents technical attribution when we need procedural documentation! The Digital Forensics Report proves WHO committed crimes, not that institutions followed proper procedures!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document shows CODI compliance!\n\n✗ JUDGE: Sustained. We need institutional procedure evidence, not forensic attribution.",
          'evidence7': "✗ YOU (PROSECUTOR): Your Honor, the Victim's Account...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents victim testimony instead of procedural proof! The Victim's Account describes harassment impact, not institutional compliance!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document demonstrates proper CODI procedures were followed!\n\n✗ JUDGE: Sustained. We need proof institutions acted properly, not victim statements.",
          'evidence8': "✗ YOU (PROSECUTOR): Your Honor, the Facebook post...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents cyber libel evidence instead of procedural documentation! The Facebook post shows defamation, not institutional compliance!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document proves proper procedures!\n\n✗ JUDGE: Sustained. Present institutional compliance, not additional crime evidence.",
          'evidence10': "✗ YOU (PROSECUTOR): Your Honor, the psychological report...\n\n✗ DEFENSE ATTORNEY: OBJECTION! The prosecution presents harm evidence instead of procedural proof! The Expert Psychological Report shows IMPACT, not that proper institutional procedures were followed!\n\n✗ DEFENSE ATTORNEY: The Institutional Policy Document demonstrates CODI compliance with RA 11313!\n\n✗ JUDGE: Sustained. We need proof of proper institutional handling, not psychological harm assessment."
        },
        defaultWrongMsg: "✗ DEFENSE ATTORNEY: Objection! That evidence doesn't prove proper institutional procedures were followed!\n\n✗ DEFENSE ATTORNEY: Your Honor, while the prosecution's selected evidence may be relevant to the case, it doesn't demonstrate that institutional mechanisms properly addressed the complaints!\n\n✗ JUDGE: Sustained. Prosecution, select evidence that directly proves institutional compliance and proper procedures.\n\n✗ Credibility Score: -5"
      },
      // END
    ];

    function createKeyboard() {
      const keyboard = document.getElementById('keyboard');
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
      keyboard.innerHTML = '';
      letters.forEach(letter => {
        const btn = document.createElement('button');
        btn.className = 'key-button'; btn.textContent = letter;
        btn.onclick = () => { sounds.menuMove(); addLetter(letter); };
        keyboard.appendChild(btn);
      });
    }

    function addLetter(letter) { if (currentName.length < MAX_NAME_LENGTH) { currentName += letter; updateNameDisplay(); } }

    function updateNameDisplay() {
      document.getElementById('name-display').textContent = currentName || '';
      document.getElementById('backspace-btn').disabled = currentName.length === 0;
      document.getElementById('done-btn').disabled = currentName.length === 0;
      document.querySelectorAll('.key-button').forEach(btn => { btn.disabled = currentName.length >= MAX_NAME_LENGTH; });
    }

    document.getElementById('backspace-btn').onclick = () => { if (currentName.length > 0) { sounds.menuMove(); currentName = currentName.slice(0, -1); updateNameDisplay(); } };
    document.getElementById('quit-btn').onclick = () => { sounds.menuMove(); currentName = ''; updateNameDisplay(); };
    document.getElementById('done-btn').onclick = () => {
      if (currentName.length > 0) {
        sounds.menuSelect();
        playerName = currentName;
        document.getElementById('player-name').textContent = playerName;
        changeBackgroundMusic('walking');
        gsap.to('#name-screen', {
          opacity: 0, duration: 0.5, onComplete: () => {
            document.getElementById('name-screen').classList.add('hidden');
            gsap.set('#name-screen', { opacity: 1 });
            gameMode = 'walking';
          }
        });
      }
    };

    function initializeTipsScreen() {
    }

    function createTipCard(tip, category) {
    }

    function toggleTipCollection(tip, card) {
    }

    function updateCollectedCount() {
    }

    function showTipsScreen() {
    }

    function closeTipsScreen() {
    }

    document.getElementById('skip-tips-btn').onclick = () => {
    };

    document.getElementById('proceed-btn').onclick = () => {
    };

    function showInventory() {
      const inventoryContent = document.getElementById('inventory-content');
      inventoryContent.innerHTML = '';

      if (collectedTips.length === 0) {
        inventoryContent.innerHTML = '<div class="empty-inventory">* No resources collected.<br>* You skipped the library phase.</div>';
      } else {
        collectedTips.forEach(tip => {
          const item = document.createElement('div');
          item.className = 'inventory-item';
          let html = `<div class="inventory-item-title">${tip.title}</div>`;
          if (tip.subtitle) html += `<div class="inventory-item-subtitle">${tip.subtitle}</div>`;
          html += `<div class="inventory-item-content">${tip.content}</div>`;
          item.innerHTML = html;
          inventoryContent.appendChild(item);
        });
      }

      gsap.fromTo('#inventory-modal',
        { scale: 0.8, opacity: 0 },
        {
          scale: 1, opacity: 1, duration: 0.5, ease: "back.out(1.7)",
          onStart: () => { document.getElementById('inventory-modal').classList.add('active'); }
        }
      );
    }

    document.getElementById('close-inventory-btn').onclick = () => {
      sounds.menuSelect();
      gsap.to('#inventory-modal', {
        scale: 0.8, opacity: 0, duration: 0.3,
        onComplete: () => {
          document.getElementById('inventory-modal').classList.remove('active');
          gsap.set('#inventory-modal', { scale: 1, opacity: 1 });
        }
      });
    };

    // Evidence Panel Functions
    function updateEvidenceDisplay() {
      const evidenceList = document.getElementById('evidence-list');
      evidenceList.innerHTML = '';

      collectedEvidence.forEach((evidence, index) => {
        const card = document.createElement('div');
        let cardClass = 'evidence-card';
        if (index === selectedEvidenceIndex) {
          cardClass += ' selected';
          if (evidenceAnswerMode) cardClass += ' answer-mode';
        }
        card.className = cardClass;

        card.innerHTML = `
          <div class="evidence-icon"><img src="${evidence.icon}" style="width:100%;height:100%;object-fit:cover;"></div>
          <div class="evidence-card-info">
            <div class="evidence-card-title">${evidence.title}</div>
            <div class="evidence-card-type">${evidence.type}</div>
          </div>
        `;
        card.onclick = () => selectEvidence(index);
        card.ontouchstart = (e) => {
          e.preventDefault();
          selectEvidence(index);
        };
        evidenceList.appendChild(card);
      });

      document.getElementById('evidence-count').textContent = collectedEvidence.length;
      document.getElementById('evidence-total').textContent = evidenceDatabase.length;

      if (collectedEvidence.length > 0) {
        displayEvidenceDetail(selectedEvidenceIndex);
      }

      // Update footer message if in answer mode
      if (evidenceAnswerMode) {
        document.getElementById('evidence-panel').querySelector('.evidence-header p').textContent =
          '★ SELECT EVIDENCE ★ | Use ARROW KEYS to navigate | Press ENTER to submit your choice';
      }
    }

    function selectEvidence(index) {
      sounds.menuMove();
      selectedEvidenceIndex = index;
      updateEvidenceDisplay();

      // If we're in evidence-answer mode, highlight the selection
      if (gameMode === 'evidenceAnswer') {
        const evidenceId = collectedEvidence[index].id;
        console.log('Selected evidence:', evidenceId);
      }
    }

    function displayEvidenceDetail(index) {
      if (index < 0 || index >= collectedEvidence.length) return;

      const evidence = collectedEvidence[index];
      document.getElementById('evidence-image').textContent = evidence.icon;
      document.getElementById('evidence-title').textContent = evidence.title;
      document.getElementById('evidence-type').textContent = evidence.type;
      document.getElementById('evidence-description').textContent = evidence.description;
    }

    function openEvidencePanel() {
      sounds.menuSelect();
      const panel = document.getElementById('evidence-panel');
      const submitBtn = document.getElementById('evidence-submit-btn');
      
      // Show submit button only in evidence answer mode
      if (evidenceAnswerMode) {
        submitBtn.classList.add('active');
      } else {
        submitBtn.classList.remove('active');
      }
      
      panel.classList.add('active');
      gsap.fromTo('#evidence-panel',
        { opacity: 0 },
        { opacity: 1, duration: 0.3 }
      );
      updateEvidenceDisplay();
    }

    function closeEvidencePanel() {
      sounds.menuSelect();
      const panel = document.getElementById('evidence-panel');
      gsap.to('#evidence-panel', {
        opacity: 0, duration: 0.3,
        onComplete: () => {
          panel.classList.remove('active');
        }
      });
    }

    // Evidence-based question handling
    let evidenceAnswerMode = false;
    let currentEvidenceQuestion = null;

    function startEvidenceQuestion(question) {
      gameMode = 'evidenceAnswer';
      evidenceAnswerMode = true;
      currentEvidenceQuestion = question;

      // Show instructions in the battle box
      const questionText = document.getElementById('question-text');
      const answerButtons = document.getElementById('answer-buttons');

      typeText(question.text, questionText);

      // Replace answer buttons with evidence instruction
      answerButtons.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 20px; border: 3px solid #ff8c00; background-color: #1a1a00;">
          <p style="font-size: 12px; color: #ff8c00; margin-bottom: 15px;">★ EXAMINE THE EVIDENCE ★</p>
          <p style="font-size: 10px; color: #fff; line-height: 1.8;">
            Press TAB to open the Evidence Panel.<br>
            Select the correct evidence to support your argument.<br>
            Press ENTER to submit your choice.
          </p>
        </div>
      `;

      // Auto-open evidence panel after brief delay
      setTimeout(() => {
        openEvidencePanel();
      }, 1000);
    }

    function submitEvidenceAnswer() {
      if (!evidenceAnswerMode || !currentEvidenceQuestion) return;

      const selectedEvidence = collectedEvidence[selectedEvidenceIndex];
      const q = currentEvidenceQuestion;

      // Check if selected evidence ID matches any correct answer
      // Support both single correctEvidenceId and multiple correctEvidenceIds
      let isCorrect = false;
      let correctMessage = q.correctMsg;

      if (q.correctEvidenceIds && Array.isArray(q.correctEvidenceIds)) {
        // Multiple correct answers
        isCorrect = q.correctEvidenceIds.includes(selectedEvidence.id);
        if (isCorrect && q.correctMsgs) {
          // Use specific message for this evidence
          correctMessage = q.correctMsgs[selectedEvidence.id] || q.correctMsg;
        }
      } else if (q.correctEvidenceId) {
        // Single correct answer (backward compatibility)
        isCorrect = selectedEvidence.id === q.correctEvidenceId;
      }

      // Close evidence panel
      closeEvidencePanel();

      // Disable further submissions
      evidenceAnswerMode = false;
      answeringQuestion = true;

      // Visual feedback
      setTimeout(() => {
        if (isCorrect) {
          sounds.correct();
          gsap.to('#enemy-sprite', { scale: 1.2, duration: 0.1, yoyo: true, repeat: 1 });
          score += 100;
          updateScore();

          // Show correct message
          const correctParts = Array.isArray(correctMessage) ? correctMessage.slice() :
            typeof correctMessage === 'function' ? [correctMessage] :
              (correctMessage || '').split(/\n\s*\n+/).map(s => s.trim()).filter(Boolean);

          if (correctParts.length > 1) {
            showQuestionDialogues(correctParts, () => {
              currentQuestionIndex++;
              loadQuestion(currentQuestionIndex);
            });
          } else {
            showDialogueMessage(correctParts[0] || correctMessage, () => {
              currentQuestionIndex++;
              loadQuestion(currentQuestionIndex);
            });
          }
        } else {
          sounds.wrong();
          gsap.to('#game-container', { x: '+=10', duration: 0.05, yoyo: true, repeat: 5, onComplete: () => gsap.set('#game-container', { x: 0 }) });
          gsap.to('#enemy-sprite', { scale: 1.3, rotation: 15, duration: 0.2, yoyo: true, repeat: 1, ease: "power2.inOut" });
          currentHP -= 5;
          updateHP();

          if (currentHP <= 0) {
            setTimeout(gameOver, 1500);
          } else {
            // Get specific wrong message for this evidence, or use default
            let wrongMessage = q.defaultWrongMsg || q.wrongMsg || "✗ That evidence doesn't support your argument! Choose more carefully.";

            if (q.wrongMsgs && q.wrongMsgs[selectedEvidence.id]) {
              wrongMessage = q.wrongMsgs[selectedEvidence.id];
            }

            const parts = (wrongMessage || '').split(/\n\s*\n+/).map(s => s.trim()).filter(Boolean);

            if (parts.length > 1) {
              showQuestionDialogues(parts, () => {
                currentQuestionIndex++;
                loadQuestion(currentQuestionIndex);
              });
            } else {
              showDialogueMessage(wrongMessage, () => {
                currentQuestionIndex++;
                loadQuestion(currentQuestionIndex);
              });
            }
          }
        }
      }, 300);
    }

    document.getElementById('evidence-close-btn').onclick = () => {
      // Allow closing in evidence answer mode - user can review question
      closeEvidencePanel();
    };

    // Evidence submit button handler
    document.getElementById('evidence-submit-btn').onclick = () => {
      if (evidenceAnswerMode) {
        sounds.menuSelect();
        submitEvidenceAnswer();
      }
    };

    // Evidence panel navigation with arrow keys
    function navigateEvidence(direction) {
      if (collectedEvidence.length === 0) return;

      if (direction === 'up') {
        selectedEvidenceIndex = Math.max(0, selectedEvidenceIndex - 1);
      } else if (direction === 'down') {
        selectedEvidenceIndex = Math.min(collectedEvidence.length - 1, selectedEvidenceIndex + 1);
      }

      sounds.menuMove();
      updateEvidenceDisplay();
    }

    let isTyping = false, currentText = '', targetText = '', charIndex = 0;

    // Per-question dialogue sequencing (e.g., JUDGE:, PROSECUTOR:, OPPOSITION:)
    let questionDialogues = [];
    let questionDialogueIndex = 0;
    let questionDialogueCallback = null;
    let inQuestionDialogue = false;
    let waitingForQuestionConfirm = false;
    let questionConfirmCallback = null;

    function typeText(text, element, callback) {
      targetText = text;
      currentText = '';
      charIndex = 0;
      isTyping = true;
      element.innerHTML = '';

      function typeChar() {
        if (charIndex < targetText.length) {
          if (charIndex % 3 === 0) sounds.textBlip(); // Less frequent beeps
          currentText += targetText[charIndex];
          element.innerHTML = currentText.replace(/\n/g, '<br>');
          charIndex++;
          setTimeout(typeChar, 20); // Faster typing for longer text
        } else {
          isTyping = false;
          if (callback) callback();
        }
      }
      typeChar();
    }

    function startDialogue() {
      gameMode = 'dialogue'; dialogueIndex = 0; dialogues = [...narratorDialogues]; currentDialoguePhase = 'narrator';
      const dialogueBox = document.getElementById('dialogue-box');
      gsap.fromTo('#dialogue-box', { opacity: 0, y: -20 }, {
        opacity: 1, y: 0, duration: 0.3,
        onStart: () => { dialogueBox.classList.add('active'); }
      });
      showNextDialogue();
    }

    function showNextDialogue() {
      if (dialogueIndex < dialogues.length) {
        const dialogue = typeof dialogues[dialogueIndex] === 'function' ? dialogues[dialogueIndex]() : dialogues[dialogueIndex];
        typeText(dialogue, document.getElementById('dialogue-text'));
        dialogueIndex++;
      } else {
        if (currentDialoguePhase === 'narrator') {
          dialogues = [...npcTipsDialogues];
          dialogueIndex = 0;
          currentDialoguePhase = 'npc';
          transitionToScene('library');
          showNextDialogue();
        } else if (currentDialoguePhase === 'npc') {
          gsap.to('#dialogue-box', {
            opacity: 0, duration: 0.3, onComplete: () => {
              document.getElementById('dialogue-box').classList.remove('active');
              showTipsMenu();
            }
          });
        } else if (currentDialoguePhase === 'tipInfo') {
          gsap.to('#dialogue-box', {
            opacity: 0, duration: 0.3, onComplete: () => {
              document.getElementById('dialogue-box').classList.remove('active');
              showTipsMenu();
            }
          });
        }
      }
    }

    function showTipsMenu() {
      document.getElementById('tips-choice-box').classList.add('active');
      gsap.fromTo('#tips-choice-box', { opacity: 0, y: -20 }, { opacity: 1, y: 0, duration: 0.3 });
    }

    // Show a sequence of small dialogues before a question (e.g., JUDGE:, PROSECUTOR:, OPPOSITION:)
    function showQuestionDialogues(lines, onComplete) {
      if (!lines || !lines.length) { onComplete && onComplete(); return; }
      questionDialogues = lines.slice();
      questionDialogueIndex = 0;
      questionDialogueCallback = onComplete || null;
      inQuestionDialogue = true;

      const dialogueBox = document.getElementById('dialogue-box');
      const battleBox = document.getElementById('battle-box');

      // Hide the battle box first so the dialogue appears alone (like showDialogueMessage does)
      gsap.to('#battle-box', {
        opacity: 0,
        duration: 0.2,
        onComplete: () => {
          if (battleBox) battleBox.classList.remove('active');

          gsap.fromTo('#dialogue-box', { opacity: 0, y: -20 }, {
            opacity: 1, y: 0, duration: 0.3,
            onStart: () => { dialogueBox.classList.add('active'); }
          });

          // start first line (may include speaker prefix like 'JUDGE: text')
          applySpeakerAndType(questionDialogues[questionDialogueIndex]);
        }
      });
    }

    function presentQuestionPrompt(q, onConfirm) {
      const dialogueBox = document.getElementById('dialogue-box');
      const battleBox = document.getElementById('battle-box');

      gsap.to('#battle-box', {
        opacity: 0,
        duration: 0.2,
        onComplete: () => {
          if (battleBox) battleBox.classList.remove('active');
          dialogueBox.classList.add('active');
          gsap.fromTo('#dialogue-box', { opacity: 0, y: -20 }, { opacity: 1, y: 0, duration: 0.3 });

          typeText(q.text, document.getElementById('dialogue-text'), () => {
            waitingForQuestionConfirm = true;
            questionConfirmCallback = onConfirm || null;
          });
        }
      });
    }

    function showNextQuestionDialogue() {
      questionDialogueIndex++;
      if (questionDialogueIndex < questionDialogues.length) {
        // show next (may include prefix)
        applySpeakerAndType(questionDialogues[questionDialogueIndex]);
      } else {
        // finished
        const dialogueBox = document.getElementById('dialogue-box');
        const battleBox = document.getElementById('battle-box');
        gsap.to('#dialogue-box', {
          opacity: 0, duration: 0.3, onComplete: () => {
            dialogueBox.classList.remove('active');
            inQuestionDialogue = false;

            // Restore the battle box visuals
            if (battleBox) {
              battleBox.classList.add('active');
              gsap.fromTo('#battle-box', { opacity: 0 }, { opacity: 1, duration: 0.3 });
            }

            if (questionDialogueCallback) {
              const cb = questionDialogueCallback;
              questionDialogueCallback = null;
              cb();
            }
          }
        });
      }
    }

    function applySpeakerAndType(line) {
      // If the line is a function (like your narratorDialogues entries), evaluate it now so it can use runtime values like playerName
      if (typeof line === 'function') {
        try { line = line(); } catch (e) { console.warn('error evaluating dialogue function', e); line = '' + line; }
      }
      const speakerLabelEl = document.getElementById('speaker-label');
      const dialogueBox = document.getElementById('dialogue-box');
      // Reset classes
      dialogueBox.classList.remove('judge', 'prosecutor', 'defense');
      speakerLabelEl.style.display = 'none';

      // Expect format: 'SPEAKER: actual text' (SPEAKER optional)
      const m = /^\s*([^:]{1,20}):\s*(.*)$/i.exec(line);
      let speaker = null;
      let text = line;
      if (m) { speaker = m[1].trim(); text = m[2].trim(); }

      if (speaker) {
        speakerLabelEl.textContent = speaker.toUpperCase();
        speakerLabelEl.style.display = 'inline-block';
        // quick mapping to CSS class
        const s = speaker.toLowerCase();
        if (s.includes('judge')) dialogueBox.classList.add('judge');
        else if (s.includes('prosecut') || s.includes('you') || s.includes('prosecutor')) dialogueBox.classList.add('prosecutor');
        else if (s.includes('defense') || s.includes('defendant')) dialogueBox.classList.add('defense');
      }

      // Type the text portion
      typeText(text, document.getElementById('dialogue-text'));
    }

    function showTipInfo(tipKey) {
      sounds.menuSelect();
      const tip = tipsInfo[tipKey];

      if (!collectedTips.find(t => t.id === tipKey)) {
        collectedTips.push({
          id: tipKey,
          title: tip.title,
          subtitle: tip.subtitle,
          content: tip.dialogue.replace('* ', '')
        });
      }

      gsap.to('#tips-choice-box', {
        opacity: 0, duration: 0.3, onComplete: () => {
          document.getElementById('tips-choice-box').classList.remove('active');

          dialogues = [tip.dialogue];
          dialogueIndex = 0;
          currentDialoguePhase = 'tipInfo';

          const dialogueBox = document.getElementById('dialogue-box');
          gsap.fromTo('#dialogue-box', { opacity: 0, y: -20 }, {
            opacity: 1, y: 0, duration: 0.3,
            onStart: () => { dialogueBox.classList.add('active'); }
          });
          showNextDialogue();
        }
      });
    }

    document.getElementById('vocab-btn').onclick = () => showTipInfo('vocab1');
    document.getElementById('legal1-btn').onclick = () => showTipInfo('legal1');
    document.getElementById('legal2-btn').onclick = () => showTipInfo('legal2');
    document.getElementById('legal3-btn').onclick = () => showTipInfo('legal3');

    document.getElementById('ready-btn').onclick = () => {
      sounds.menuSelect();
      gsap.to('#tips-choice-box', {
        opacity: 0, duration: 0.3, onComplete: () => {
          document.getElementById('tips-choice-box').classList.remove('active');
          transitionToScene('courtroom', () => {
            startQuiz();
          });
        }
      });
    };

    function transitionToScene(sceneName, callback) {
      const libraryScene = document.getElementById('library-scene');
      const courtroomScene = document.getElementById('courtroom-scene');
      const transitionOverlay = document.getElementById('transition-overlay');

      const currentScene = !libraryScene.classList.contains('hidden') ? libraryScene :
        !courtroomScene.classList.contains('hidden') ? courtroomScene : null;

      gsap.to(transitionOverlay, {
        opacity: 1,
        duration: 0.4,
        ease: "power2.in",
        onComplete: () => {
          if (currentScene) {
            gsap.set(currentScene, { opacity: 0 });
            currentScene.classList.add('hidden');
          }

          const newScene = sceneName === 'library' ? libraryScene : courtroomScene;
          newScene.classList.remove('hidden');
          gsap.set(newScene, { opacity: 1 });

          gsap.to(transitionOverlay, {
            opacity: 0,
            duration: 0.6,
            delay: 0.2,
            ease: "power2.out",
            onComplete: callback
          });
        }
      });
    }

    function startQuiz() {
      gameMode = 'quiz';
      const enemySprite = document.getElementById('enemy-sprite'), battleBox = document.getElementById('battle-box');
      enemySprite.classList.add('active'); battleBox.classList.add('active');
      gsap.fromTo('#enemy-sprite', { scale: 0, rotation: 180 }, { scale: 1, rotation: 0, duration: 0.8, ease: "back.out(1.7)" });
      gsap.to('#enemy-sprite', { y: '-=20', duration: 2, repeat: -1, yoyo: true, ease: "sine.inOut" });
      gsap.fromTo('#battle-box', { y: 100, opacity: 0 }, { y: 0, opacity: 1, duration: 0.5 });
      loadQuestion(currentQuestionIndex);
      if (isMobile) updateMobileControls();
    }

    function loadQuestion(index) {
      if (index >= questions.length) { victory(); return; }
      const q = questions[index];

      // Check if this is an evidence-based question
      if (q.questionType === 'evidence') {
        // Show pre-dialogues if any, then start evidence question
        if (Array.isArray(q.preDialogues) && q.preDialogues.length > 0) {
          showQuestionDialogues(q.preDialogues, () => {
            startEvidenceQuestion(q);
          });
        } else {
          startEvidenceQuestion(q);
        }
        return;
      }

      // Regular question flow (existing code)
      const questionText = document.getElementById('question-text');
      const answerButtons = document.getElementById('answer-buttons');

      if (Array.isArray(q.preDialogues) && q.preDialogues.length > 0) {
        showQuestionDialogues(q.preDialogues, () => {
          presentQuestionPrompt(q, () => { renderQuestionContent(q, questionText, answerButtons); });
        });
      } else {
        presentQuestionPrompt(q, () => { renderQuestionContent(q, questionText, answerButtons); });
      }
    }

    function renderQuestionContent(q, questionText, answerButtons) {
      typeText(q.text, questionText);
      answerButtons.innerHTML = '';
      q.answers.forEach((answer, i) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn'; btn.textContent = '★ ' + answer;
        btn.onclick = () => checkAnswer(i);
        btn.onmouseenter = () => sounds.menuMove();
        gsap.fromTo(btn, { x: -50, opacity: 0 }, { x: 0, opacity: 1, duration: 0.3, delay: i * 0.1 });
        answerButtons.appendChild(btn);
      });
      answeringQuestion = false;
    }

    function checkAnswer(selectedIndex) {
      if (answeringQuestion) return;
      answeringQuestion = true;
      const q = questions[currentQuestionIndex], buttons = document.querySelectorAll('.answer-btn');
      buttons.forEach(btn => btn.disabled = true);

      if (selectedIndex === q.correct) {
        buttons[selectedIndex].classList.add('correct');
        sounds.correct();
        gsap.to('#enemy-sprite', { scale: 1.2, duration: 0.1, yoyo: true, repeat: 1 });
        score += 100;
        updateScore();
        // Support multi-part correct messages (array, function, or string with blank-line separators)
        let correctParts = [];
        if (Array.isArray(q.correctMsg)) {
          correctParts = q.correctMsg.slice();
        } else if (typeof q.correctMsg === 'function') {
          correctParts = [q.correctMsg];
        } else {
          correctParts = (q.correctMsg || '').split(/\n\s*\n+/).map(s => s.trim()).filter(Boolean);
        }

        if (correctParts.length > 1) {
          showQuestionDialogues(correctParts, () => {
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
          });
        } else {
          showDialogueMessage(correctParts[0] || q.correctMsg, () => {
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
          });
        }
      } else {
        buttons[selectedIndex].classList.add('wrong');
        buttons[q.correct].classList.add('correct');
        sounds.wrong();
        gsap.to('#game-container', { x: '+=10', duration: 0.05, yoyo: true, repeat: 5, onComplete: () => gsap.set('#game-container', { x: 0 }) });
        gsap.to('#enemy-sprite', { scale: 1.3, rotation: 15, duration: 0.2, yoyo: true, repeat: 1, ease: "power2.inOut" });
        currentHP -= 5;
        updateHP();

        // Get the specific wrong message for this answer
        let wrongMsgIndex = selectedIndex;
        if (selectedIndex > q.correct) {
          wrongMsgIndex = selectedIndex - 1;
        }
        const wrongMessage = q.wrongMsgs[wrongMsgIndex];

        if (currentHP <= 0) {
          setTimeout(gameOver, 1500);
        } else {
          // If the wrong message contains multiple speaker blocks separated by blank lines,
          // split them and show each as a separate press-to-advance dialogue using showQuestionDialogues.
          const parts = (wrongMessage || '').split(/\n\s*\n+/).map(s => s.trim()).filter(Boolean);
          if (parts.length > 1) {
            showQuestionDialogues(parts, () => {
              currentQuestionIndex++;
              loadQuestion(currentQuestionIndex);
            });
          } else {
            showDialogueMessage(wrongMessage, () => {
              currentQuestionIndex++;
              loadQuestion(currentQuestionIndex);
            });
          }
        }
      }
    }

    function showDialogueMessage(text, callback) {
      const dialogueBox = document.getElementById('dialogue-box');
      const battleBox = document.getElementById('battle-box');

      // Hide battle box first
      gsap.to('#battle-box', {
        opacity: 0,
        duration: 0.2,
        onComplete: () => {
          battleBox.classList.remove('active');

          // Show dialogue box
          dialogueBox.classList.add('active');
          gsap.fromTo('#dialogue-box',
            { opacity: 0, y: 20 },
            { opacity: 1, y: 0, duration: 0.3 }
          );

          // Type the text (faster for longer messages)
          typeText(text, document.getElementById('dialogue-text'), () => {
            // Wait longer for longer messages
            const waitTime = text.length > 300 ? 4000 : 2500;
            setTimeout(() => {
              gsap.to('#dialogue-box', {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                  dialogueBox.classList.remove('active');

                  // Show battle box again
                  battleBox.classList.add('active');
                  gsap.fromTo('#battle-box',
                    { opacity: 0 },
                    {
                      opacity: 1, duration: 0.3, onComplete: () => {
                        if (callback) callback();
                      }
                    }
                  );
                }
              });
            }, waitTime);
          });
        }
      });
    }

    function updateHP() {
      document.getElementById('current-hp').textContent = currentHP;
      const percentage = (currentHP / maxHP) * 100;
      gsap.to('#hp-bar', { width: percentage + '%', duration: 0.5, ease: "power2.out" });
      if (percentage <= 25) document.getElementById('hp-bar').style.backgroundColor = '#ff0000';
    }

    function updateScore() {
      gsap.to(document.getElementById('score'), { innerText: score, duration: 0.5, snap: { innerText: 1 }, ease: "power2.out" });
    }

    // Ending tier configuration based on credibility score
    const ENDING_TIERS = {
      ACE: {
        min: 45,
        title: '★ ACE PROSECUTOR ★',
        rank: 'S',
        dialogues: [
          "JUDGE: *strikes gavel with finality* The court will now render its verdict based on the evidence and arguments presented.",
          `JUDGE: Based on the overwhelming evidence presented by the prosecution, this court finds the defendant, Mr. Dwg, GUILTY on all counts:
      
      - Violation of RA 9995 Section 4(a) for unauthorized upskirt photography at NAIA
      - Violation of RA 11313 Section 4 for gender-based online sexual harassment against Ms. Maria
      - Violation of RA 10175 Section 4c for cyber libel
            
      The defendant's systematic harassment of Ms. Patricia Santos over six months, combined with the deplorable upskirt photography at NAIA Terminal 3, represents a clear pattern of predatory behavior.`,
          () => `JUDGE: Attorney ${playerName}, I must commend Prosecutor on an exceptional presentation. Your mastery of RA 11313, RA 9995, and RA 10175 was evident throughout the case. Your presentation was flawless, legal arguments were precise, and your understanding of institutional requirements and the  evidence you held  was magnificent. This is exactly the level of prosecution Philippine cybercrime victims needed. Given that you demonstrated expertise, the court strongly recommended you to consider an involvement in training and mentoring future lawyers in the field of cybercrime and digital justice. Your proficiency and clarity in applying these laws would be invaluable in shaping the next generation of prosecutors.Court is adjourned.`,
          "DEFENSE ATTORNEY : *extends hand* Masterful prosecution. You may have presented an airtight case to damage my case record, but we'll see if it's just beginner's luck. You have my regards—this is what competent advocacy looks like. *applauds*",
          `★ ACHIEVEMENT UNLOCKED: "CHAMPION OF JUSTICE" ★

          The Department of Justice sends commendation. You're invited to train prosecutors on cybercrime cases nationwide. Media coverage highlights your expert handling of gender-based online harassment prosecution.`
        ]
      },

      SKILLED: {
        min: 35,
        title: '★ SKILLED PROSECUTOR ★',
        rank: 'A',
        dialogues: [
          "JUDGE: *strikes gavel* The court has reached a verdict after careful deliberation.",
          `JUDGE: The court finds the defendant GUILTY on both counts. Prosecutor, you have conducted a solid prosecution with clear understanding of the applicable laws. Though there were visible confusion about evidence presentation, the court still finds your claims as reasonable. Court is adjourned.
            
      While some procedural issues arose during trial, the core evidence was compelling and properly presented.`,
          () => `JUDGE: Attorney ${playerName}, you demonstrated strong legal acumen. A few stumbles in statute citation, but overall a solid prosecution that achieved justice.`,
          "DEFENSE ATTORNEY : *nods respectfully* Well fought, Counselor. You had me worried several times. With more experience, you'll be formidable.",
          `★ ACHIEVEMENT UNLOCKED: "RISING PROSECUTOR" ★

    Your supervisor notes your strong performance. You're assigned more complex cases and recommended for advanced cybercrime law training.

    Local legal journals mention your successful prosecution of this high-profile case.`
        ]
      },
      COMPETENT: {
        min: 25,
        title: '★ ADEQUATE PROSECUTOR ★',
        rank: 'B',
        dialogues: [
          "JUDGE: *strikes gavel* After reviewing all evidence, the court renders the following verdict.",
          `JUDGE: This court finds the defendant GUILTY, though the prosecution's case made the court hesitant to decide for a decision, the court still finds your argument slightly confusing but the intent was understandable. Your confusion with evidence purposes and institutional requirements is concerning. I appoint you with court seminars. The court is adjourned.`,
          () => `JUDGE: Attorney ${playerName}, justice was served today, though your case had vulnerabilities. I recommend reviewing the specific provisions of RA 9995 before your next similar case.`,
          "MS. MARIA: We won, but... it was harder than it should have been.",
          "DEFENSE ATTORNEY: The evidence was overwhelming, but your presentation had significant gaps.",
          `★ ACHIEVEMENT UNLOCKED: "NEEDS IMPROVEMENT" ★

        Mandatory CLE on cybercrime prosecution required before handling similar cases.`
        ]
      },
      STRUGGLING: {
        min: 15,
        title: '★ STRUGGLING PROSECUTOR ★',
        rank: 'C',
        dialogues: [
          "JUDGE: *strikes gavel with visible concern* This court has deliberated extensively given the... complications during trial.",
          `JUDGE: The court finds that there is not enough evidence to reach a verdict, I hereby dismiss the case for now… The defendant has a competent lawyer, while the prosecutor struggles and confuses the court with their decisions, this is a warning for you… This is no playground, this is a courtroom for Professionals.  Do not Mistake my court as a JOKE. Court is adjourned.`,
          () => `MS. MARIA: *disappointed* There is no justice yet, please do better!`,
          `DEFENSE ATTORNEY : Your case was gift-wrapped with evidence, yet you struggled. Concerning.`,
          `★ ACHIEVEMENT: "FORMAL WARNING" ★

      Department of Justice review of competency. Mandatory remedial training. Supervised cases only.`
        ]
      },
      INADEQUATE: {
        min: 0,
        title: '★ FAILED PROSECUTOR ★',
        rank: 'D',
        dialogues: [
          "JUDGE: *strikes gavel heavily* This has been one of the most troubling prosecutions this court has witnessed.",
          `JUDGE: *visibly angry* This court finds the defendant Innocent because of the prosecution's appalling incompetence. You demonstrated fundamental ignorance of the Republic Acts, confused basic evidence, and repeatedly argued AGAINST your own case!`,
          `JUDGE: I am formally reporting you to the Department of Justice for review of prosecutorial competency. You will not handle cases without supervision pending investigation. This was professional malpractice barely saved by overwhelming evidence. Court is adjourned.`,
          () => `JUDGE: Attorney ${playerName}, your performance was unacceptable. The victim deserved better representation. I'm recommending a formal review of your qualifications.`,
          "MS. MARIA: *furious* You lost a case with mountains of evidence! You argued AGAINST me! I'm filing complaints!",
          "DEFENSE ATTORNEY : I've never seen such incompetent prosecution. You did my job for me.",
          "SUPERVISOR: Office. Now. You're suspended from all prosecutions pending DOJ investigation. You sabotaged your own case repeatedly. We're reviewing whether you're fit for this position.",
          `★ WARNING: "CAREER CRISIS" ★
      
      DOJ investigation opened. Suspension from prosecutorial duties. Competency hearing scheduled. Career in jeopardy.`
        ]
      }
    };

    function getEndingTier(finalScore) {
      if (finalScore >= ENDING_TIERS.ACE.min) return ENDING_TIERS.ACE;
      if (finalScore >= ENDING_TIERS.SKILLED.min) return ENDING_TIERS.SKILLED;
      if (finalScore >= ENDING_TIERS.COMPETENT.min) return ENDING_TIERS.COMPETENT;
      if (finalScore >= ENDING_TIERS.STRUGGLING.min) return ENDING_TIERS.STRUGGLING;
      return ENDING_TIERS.INADEQUATE;
    }

    function victory() {
      gameMode = 'victory';
      sounds.victory();

      gsap.to('#battle-box', {
        opacity: 0, y: 50, duration: 0.5,
        onComplete: () => { document.getElementById('battle-box').classList.remove('active'); }
      });

      gsap.to('#enemy-sprite', {
        scale: 0, rotation: 360, duration: 0.8,
        onComplete: () => { document.getElementById('enemy-sprite').classList.remove('active'); }
      });

      // Get the appropriate ending tier based on CREDIBILITY (currentHP), not score
      const ending = getEndingTier(currentHP);

      // Process dialogues with playerName function evaluation
      const processedDialogues = ending.dialogues.map(dialogue => {
        if (typeof dialogue === 'function') {
          return dialogue();
        }
        return dialogue;
      });

      // Show ending dialogue sequence
      showEndingDialogues(processedDialogues, ending, () => {
        // After dialogues, show the final victory screen
        showFinalVictoryScreen(ending);
      });
    }

    function showEndingDialogues(dialogues, ending, onComplete) {
      let currentIndex = 0;

      const dialogueBox = document.getElementById('dialogue-box');
      dialogueBox.classList.add('active');
      gsap.fromTo('#dialogue-box',
        { opacity: 0, y: -20 },
        { opacity: 1, y: 0, duration: 0.3 }
      );

      function showNext() {
        if (currentIndex < dialogues.length) {
          const dialogue = dialogues[currentIndex];
          applySpeakerAndType(dialogue);
          currentIndex++;

          // Set up for next dialogue
          const checkForNext = setInterval(() => {
            if (!isTyping) {
              clearInterval(checkForNext);

              // Wait for player input to continue
              const continueHandler = (e) => {
                if (e.key === 'z' || e.key === 'Z' || e.key === 'Enter') {
                  sounds.menuSelect();
                  document.removeEventListener('keydown', continueHandler);
                  showNext();
                }
              };
              document.addEventListener('keydown', continueHandler);

              // Mobile support
              const mobileHandler = () => {
                sounds.menuSelect();
                document.getElementById('mobile-action').removeEventListener('touchstart', mobileHandler);
                document.removeEventListener('keydown', continueHandler);
                showNext();
              };
              document.getElementById('mobile-action').addEventListener('touchstart', mobileHandler, { once: true });
            }
          }, 100);
        } else {
          // All dialogues shown, fade out and show final screen
          gsap.to('#dialogue-box', {
            opacity: 0, duration: 0.3,
            onComplete: () => {
              dialogueBox.classList.remove('active');
              onComplete();
            }
          });
        }
      }

      showNext();
    }

    function showFinalVictoryScreen(ending) {
      const victoryScreen = document.getElementById('victory-screen');
      victoryScreen.querySelector('h2').textContent = ending.title;

      // Update or create rank display
      let rankDisplay = victoryScreen.querySelector('.rank-display');
      if (!rankDisplay) {
        rankDisplay = document.createElement('div');
        rankDisplay.className = 'rank-display';
        victoryScreen.insertBefore(rankDisplay, victoryScreen.querySelector('p'));
      }
      rankDisplay.textContent = `RANK: ${ending.rank}`;

      // Update message with credibility instead of score
      const messageP = victoryScreen.querySelectorAll('p')[0];
      const lastDialogue = ending.dialogues[ending.dialogues.length - 1];
      messageP.textContent = lastDialogue.replace(/★|ACHIEVEMENT.*?:|WARNING.*?:/g, '').trim();

      // Show credibility score instead of regular score
      const finalScoreElement = document.getElementById('final-score-victory');
      finalScoreElement.parentElement.innerHTML = `Final Credibility: <span id="final-score-victory">${currentHP}</span> / ${maxHP}<br>Cases Won: <span>${score}</span> points`;

      gsap.fromTo('#victory-screen',
        { scale: 0, rotation: -180 },
        {
          scale: 1, rotation: 0, duration: 1, ease: "back.out(1.7)",
          onStart: () => { victoryScreen.classList.add('active'); }
        }
      );
    }

    function gameOver() {
      gameMode = 'gameover';
      gsap.to('#battle-box', { opacity: 0, duration: 0.5, onComplete: () => { document.getElementById('battle-box').classList.remove('active'); } });
      gsap.to('#enemy-sprite', { scale: 1.5, opacity: 0, duration: 1, onComplete: () => { document.getElementById('enemy-sprite').classList.remove('active'); } });
      document.getElementById('final-score-gameover').textContent = score;
      gsap.fromTo('#gameover-screen', { opacity: 0, y: 50 }, {
        opacity: 1, y: 0, duration: 1,
        onStart: () => { document.getElementById('gameover-screen').classList.add('active'); }
      });
    }

    function resetGame() {
      sounds.menuSelect();
      score = 0; currentHP = maxHP; currentQuestionIndex = 0; gameMode = 'walking'; dialogueIndex = 0;
      answeringQuestion = false; currentDialoguePhase = 'narrator'; dialogues = []; collectedTips = [];
      updateScore(); updateHP();
      gsap.to('.end-screen.active', {
        opacity: 0, duration: 0.5, onComplete: () => {
          document.querySelectorAll('.end-screen').forEach(s => s.classList.remove('active'));
          gsap.set('.end-screen', { opacity: 1 });
        }
      });
      document.getElementById('battle-box').classList.remove('active');
      document.getElementById('enemy-sprite').classList.remove('active');
      document.getElementById('tips-choice-box').classList.remove('active');

      gsap.set('#library-scene', { opacity: 0 });
      gsap.set('#courtroom-scene', { opacity: 0 });
      document.getElementById('library-scene').classList.add('hidden');
      document.getElementById('courtroom-scene').classList.add('hidden');

      gsap.killTweensOf('#enemy-sprite');
      gsap.set('#enemy-sprite', { scale: 1, rotation: 0, y: 0 });
      gsap.set('#battle-box', { opacity: 1, y: 0 });
      player.x = canvas.width / 2; player.y = canvas.height / 2;
    }

    document.getElementById('restart-victory').onclick = resetGame;
    document.getElementById('restart-gameover').onclick = resetGame;
    document.getElementById('act-btn').onclick = () => {
      if (gameMode === 'quiz' && !answeringQuestion) {
        sounds.menuSelect();
        showDialogueMessage("* You tried to ACT...", null);
      }
    };
    document.getElementById('item-btn').onclick = () => {
      if (gameMode === 'quiz' && !answeringQuestion) {
        sounds.menuSelect();
        showInventory();
      }
    };
    document.getElementById('mercy-btn').onclick = () => {
      if (gameMode === 'quiz' && !answeringQuestion) {
        sounds.menuSelect();
        showDialogueMessage("* The enemy refuses your mercy!", null);
      }
    };

    document.addEventListener('keydown', (e) => {

      if (gameMode === 'startMenu' && e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('start-game-btn').click();
        return;
      }

      if (gameMode === 'nameEntry') {
        if (e.key.length === 1 && /[a-zA-Z]/.test(e.key)) { e.preventDefault(); sounds.menuMove(); addLetter(e.key.toUpperCase()); }
        else if (e.key === 'Backspace') { e.preventDefault(); document.getElementById('backspace-btn').click(); }
        else if (e.key === 'Enter') { e.preventDefault(); if (currentName.length > 0) document.getElementById('done-btn').click(); }
        return;
      }

      // TAB key to open/close evidence panel
      if (e.key === 'Tab') {
        e.preventDefault();
        const evidencePanel = document.getElementById('evidence-panel');
        if (evidencePanel.classList.contains('active')) {
          closeEvidencePanel();
        } else if (gameMode === 'quiz') {
          openEvidencePanel();
        }
        return;
      }

      // ESC key to close evidence panel
      if (e.key === 'Escape') {
        const evidencePanel = document.getElementById('evidence-panel');
        if (evidencePanel.classList.contains('active')) {
          e.preventDefault();
          closeEvidencePanel();
        }
        return;
      }

      // Arrow navigation in evidence panel
      if (document.getElementById('evidence-panel').classList.contains('active')) {
        if (e.key === 'ArrowUp') {
          e.preventDefault();
          navigateEvidence('up');
          return;
        } else if (e.key === 'ArrowDown') {
          e.preventDefault();
          navigateEvidence('down');
          return;
        } else if (e.key === 'Enter' && evidenceAnswerMode) {
          // Submit evidence as answer
          e.preventDefault();
          submitEvidenceAnswer();
          return;
        }
      }

      keys[e.key] = true;

      // If we're in a per-question dialogue sequence, handle Z/Enter here and don't fall through
      if (inQuestionDialogue && (e.key === 'z' || e.key === 'Z' || e.key === 'Enter')) {
        e.preventDefault();
        if (isTyping) {
          // finish typing immediately
          isTyping = false;
          document.getElementById('dialogue-text').textContent = targetText;
        } else {
          sounds.menuSelect();
          showNextQuestionDialogue();
        }
        return;
      }

      // If we're waiting for the player to press Z/ENTER to show the question choices
      if (waitingForQuestionConfirm && (e.key === 'z' || e.key === 'Z' || e.key === 'Enter')) {
        e.preventDefault();
        if (isTyping) {
          // finish typing immediately
          isTyping = false;
          document.getElementById('dialogue-text').textContent = targetText;
        } else {
          sounds.menuSelect();
          waitingForQuestionConfirm = false;
          const dialogueBox = document.getElementById('dialogue-box');
          const battleBox = document.getElementById('battle-box');
          gsap.to('#dialogue-box', {
            opacity: 0, duration: 0.3, onComplete: () => {
              dialogueBox.classList.remove('active');
              // restore battle box visuals and then run the callback to render choices
              if (battleBox) {
                battleBox.classList.add('active');
                gsap.fromTo('#battle-box', { opacity: 0 }, { opacity: 1, duration: 0.3 });
              }
              if (questionConfirmCallback) {
                const cb = questionConfirmCallback;
                questionConfirmCallback = null;
                cb();
              }
            }
          });
        }
        return;
      }

      if ((e.key === 'z' || e.key === 'Z' || e.key === 'Enter')) {
        e.preventDefault();
        if (gameMode === 'walking' && canInteract) { sounds.menuSelect(); startDialogue(); }
        else if (gameMode === 'dialogue' && !isTyping) { sounds.menuSelect(); showNextDialogue(); }
        else if (gameMode === 'dialogue' && isTyping) { isTyping = false; document.getElementById('dialogue-text').textContent = targetText; }
      }
    });
    document.addEventListener('keyup', (e) => { keys[e.key] = false; });

    function update() {
      if (gameMode === 'walking') {
        if (keys['ArrowUp'] || keys['w'] || keys['W']) player.y -= player.speed;
        if (keys['ArrowDown'] || keys['s'] || keys['S']) player.y += player.speed;
        if (keys['ArrowLeft'] || keys['a'] || keys['A']) player.x -= player.speed;
        if (keys['ArrowRight'] || keys['d'] || keys['D']) player.x += player.speed;
        if (mobileKeys.up) player.y -= player.speed;
        if (mobileKeys.down) player.y += player.speed;
        if (mobileKeys.left) player.x -= player.speed;
        if (mobileKeys.right) player.x += player.speed;
        player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
        player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));
        const dist = Math.hypot(player.x - npc.x, player.y - npc.y);
        canInteract = dist < 80;
      }
    }

    const playerImg = new Image();
    playerImg.src = 'player.png'; // player image path
    
    const npcImg = new Image();
    npcImg.src = 'ron.png'; // sir ron image path
    
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (gameMode === 'walking' || gameMode === 'dialogue') {
        // Draw NPC (Quiz Master)
        if (npcImg.complete) {
          ctx.drawImage(npcImg, npc.x - npc.size / 2, npc.y - npc.size / 2, npc.size, npc.size);
        } else {
          // Fallback to colored square if image not loaded
          ctx.fillStyle = npc.color; 
          ctx.fillRect(npc.x - npc.size / 2, npc.y - npc.size / 2, npc.size, npc.size);
        }
        
        ctx.fillStyle = '#fff'; ctx.font = '10px "Press Start 2P"'; ctx.textAlign = 'center';
        ctx.fillText('ATTORNEY GALLEON', npc.x, npc.y - npc.size - 5);
        
        // Draw Player
        if (playerImg.complete) {
          ctx.drawImage(playerImg, player.x - player.size / 2, player.y - player.size / 2, player.size, player.size);
        } else {
          // Fallback to colored square if image not loaded
          ctx.fillStyle = player.color; 
          ctx.fillRect(player.x - player.size / 2, player.y - player.size / 2, player.size, player.size);
        }
        
        if (canInteract && gameMode === 'walking') {
          ctx.fillStyle = '#ff8c00'; ctx.font = '8px "Press Start 2P"';
          ctx.fillText(isMobile ? 'Press Z Button' : 'Press Z', player.x, player.y - 30);
        }
      }
    }

    function drawDesk(ctx, x, y, scale) {
      const s = scale;

      // Desk shadow
      ctx.fillStyle = officeColors.deskDark;
      ctx.fillRect(x + s, y + 17 * s, 30 * s, 2 * s);

      // Desk top
      ctx.fillStyle = officeColors.desk;
      ctx.fillRect(x, y, 30 * s, 18 * s);

      // Wood grain
      ctx.fillStyle = officeColors.deskLight;
      ctx.fillRect(x + 2 * s, y + s, 26 * s, s);
      ctx.fillRect(x + 2 * s, y + 4 * s, 26 * s, s);

      // Desk edge
      ctx.fillStyle = officeColors.deskDark;
      ctx.fillRect(x, y + 16 * s, 30 * s, 2 * s);

      // Drawer handles
      ctx.fillStyle = officeColors.gold;
      ctx.fillRect(x + 4 * s, y + 10 * s, 4 * s, 2 * s);
      ctx.fillRect(x + 22 * s, y + 10 * s, 4 * s, 2 * s);

      // Papers
      ctx.fillStyle = officeColors.paper;
      ctx.fillRect(x + 3 * s, y + 3 * s, 8 * s, 6 * s);
      ctx.fillStyle = officeColors.paperDark;
      ctx.fillRect(x + 3 * s, y + 3 * s, 8 * s, s);

      // Book
      ctx.fillStyle = '#8B0000';
      ctx.fillRect(x + 13 * s, y + 2 * s, 5 * s, 8 * s);
      ctx.fillStyle = officeColors.gold;
      ctx.fillRect(x + 14 * s, y + 4 * s, 3 * s, s);

      // Coffee mug
      ctx.fillStyle = '#4A2511';
      ctx.fillRect(x + 20 * s, y + 4 * s, 4 * s, 4 * s);
      ctx.fillRect(x + 24 * s, y + 5 * s, 2 * s, 2 * s);

      // Lamp
      ctx.fillStyle = officeColors.lampBase;
      ctx.fillRect(x + 2 * s, y + 11 * s, 2 * s, 4 * s);
      ctx.fillStyle = officeColors.lamp;
      ctx.fillRect(x, y + 8 * s, 4 * s, 3 * s);
    }

    function drawBookshelf(ctx, x, y, w, scale) {
      const s = scale;

      // Frame
      ctx.fillStyle = officeColors.bookshelf;
      ctx.fillRect(x, y, w * s, 32 * s);

      // Border
      ctx.fillStyle = officeColors.woodDark;
      ctx.fillRect(x, y, w * s, 2 * s);
      ctx.fillRect(x, y + 30 * s, w * s, 2 * s);
      ctx.fillRect(x, y, 2 * s, 32 * s);
      ctx.fillRect(x + (w - 2) * s, y, 2 * s, 32 * s);

      // Shelves
      ctx.fillStyle = officeColors.wood;
      ctx.fillRect(x + 2 * s, y + 10 * s, (w - 4) * s, 2 * s);
      ctx.fillRect(x + 2 * s, y + 20 * s, (w - 4) * s, 2 * s);

      // Books
      const bookColors = ['#8B0000', '#00008B', '#006400', '#8B008B', '#FF8C00'];
      let bookX = x + 3 * s;

      for (let shelf = 0; shelf < 3; shelf++) {
        bookX = x + 3 * s;
        const shelfY = y + (3 + shelf * 10) * s;

        for (let i = 0; i < 8; i++) {
          const bookWidth = (3 + (i % 2)) * s;
          const bookHeight = (6 + (i % 3)) * s;
          const bookColor = bookColors[i % bookColors.length];

          ctx.fillStyle = bookColor;
          ctx.fillRect(bookX, shelfY, bookWidth, bookHeight);

          ctx.fillStyle = officeColors.gold;
          ctx.fillRect(bookX, shelfY + 2 * s, bookWidth, s);

          bookX += bookWidth + s;
          if (bookX > x + w * s - 10 * s) break;
        }
      }
    }

    function drawSimplePlant(x, y, sway) {
      const ctx = officeCtx;

      // Pot
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(x, y + 60, 40, 40);

      // Pot rim
      ctx.fillStyle = '#A0522D';
      ctx.fillRect(x - 5, y + 60, 50, 10);

      // Pot decoration
      ctx.fillStyle = officeColors.gold;
      ctx.fillRect(x + 5, y + 70, 30, 2);

      // Stems with sway
      ctx.fillStyle = officeColors.plantDark;
      ctx.fillRect(x + 15 + sway, y + 20, 10, 40);
      ctx.fillRect(x + 10 + Math.floor(sway * 0.7), y + 30, 8, 30);
      ctx.fillRect(x + 25 + Math.floor(sway * 0.5), y + 25, 8, 35);

      // Leaves with animation
      ctx.fillStyle = officeColors.plant;
      ctx.fillRect(x + 5 + Math.floor(sway * 0.8), y + 20, 20, 20);
      ctx.fillRect(x + 20 + sway, y + 10, 20, 20);
      ctx.fillRect(x + 30 + Math.floor(sway * 0.5), y + 30, 20, 20);

      // Highlights
      ctx.fillStyle = officeColors.plantLight;
      ctx.fillRect(x + 10 + Math.floor(sway * 0.8), y + 25, 5, 5);
      ctx.fillRect(x + 25 + sway, y + 15, 5, 5);
      ctx.fillRect(x + 35 + Math.floor(sway * 0.5), y + 35, 5, 5);
    }
    function drawLampGlow(ctx, x, y) {
      const glowIntensity = 0.8 + Math.sin(officeAnimFrame * 0.05) * 0.2;

      const grad = ctx.createRadialGradient(x + 20, y + 36, 5, x + 20, y + 36, 80);
      grad.addColorStop(0, `rgba(255,165,0,${0.4 * glowIntensity})`);
      grad.addColorStop(0.5, `rgba(255,140,0,${0.15 * glowIntensity})`);
      grad.addColorStop(1, 'rgba(255,140,0,0)');

      ctx.fillStyle = grad;
      ctx.fillRect(x - 60, y - 44, 160, 160);
    }

    function updateAndDrawParticles(ctx) {
      particles.forEach(p => {
        p.y += p.speedY;
        p.x += p.speedX;

        if (p.y > officeCanvas.height) {
          p.y = 0;
          p.x = Math.random() * officeCanvas.width;
        }
        if (p.x < 0) p.x = officeCanvas.width;
        if (p.x > officeCanvas.width) p.x = 0;

        ctx.fillStyle = `rgba(255,255,255,${p.opacity})`;
        ctx.fillRect(p.x, p.y, p.size, p.size);
      });
    }

    function drawLightRays(ctx) {
      ctx.save();
      ctx.globalAlpha = 0.1 + Math.sin(officeAnimFrame * 0.03) * 0.05;

      for (let i = 0; i < 5; i++) {
        const x = 200 + i * 150;
        const grad = ctx.createLinearGradient(x, 0, x, 300);
        grad.addColorStop(0, 'rgba(255,200,100,0.3)');
        grad.addColorStop(1, 'rgba(255,200,100,0)');

        ctx.fillStyle = grad;
        ctx.fillRect(x - 30, 0, 60, 300);
      }

      ctx.restore();
    }
    function drawOfficeBackground() {
      const ctx = officeCtx;
      const colors = officeColors;

      // Clear and draw base floor
      ctx.fillStyle = colors.floor;
      ctx.fillRect(0, 0, officeCanvas.width, officeCanvas.height);

      // Draw floor tiles
      const tileSize = 40;
      for (let y = 0; y < officeCanvas.height; y += tileSize) {
        for (let x = 0; x < officeCanvas.width; x += tileSize) {
          if ((Math.floor(x / tileSize) + Math.floor(y / tileSize)) % 2 === 0) {
            ctx.fillStyle = colors.floorDark;
          } else {
            ctx.fillStyle = colors.floor;
          }
          ctx.fillRect(x, y, tileSize, tileSize);

          ctx.strokeStyle = colors.floorDark;
          ctx.lineWidth = 1;
          ctx.strokeRect(x, y, tileSize, tileSize);
        }
      }

      // Ambient shadow gradient
      const shadowGrad = ctx.createRadialGradient(
        officeCanvas.width / 2, officeCanvas.height / 2, 100,
        officeCanvas.width / 2, officeCanvas.height / 2, 600
      );
      shadowGrad.addColorStop(0, 'rgba(0,0,0,0)');
      shadowGrad.addColorStop(1, 'rgba(0,0,0,0.4)');
      ctx.fillStyle = shadowGrad;
      ctx.fillRect(0, 0, officeCanvas.width, officeCanvas.height);

      // Responsive desk and aisle positioning
      const isMobileView = officeCanvas.width < 768;
      const aisleWidth = isMobileView ? Math.min(150, officeCanvas.width * 0.4) : 200;
      const aisleX = (officeCanvas.width - aisleWidth) / 2;

      // Calculate desk positions - ensure they stay outside the aisle
      const deskWidth = isMobileView ? 80 : 120;
      const deskHeight = isMobileView ? 60 : 80;
      const leftDeskX = Math.max(10, aisleX - deskWidth - 20);
      const rightDeskX = Math.min(officeCanvas.width - deskWidth - 10, aisleX + aisleWidth + 20);

      // Draw carpet in center (drawn before desks so desks appear on top)
      ctx.fillStyle = colors.carpet;
      ctx.fillRect(aisleX, 0, aisleWidth, officeCanvas.height);

      ctx.fillStyle = colors.goldDark;
      ctx.fillRect(aisleX, 0, 8, officeCanvas.height);
      ctx.fillRect(aisleX + aisleWidth - 8, 0, 8, officeCanvas.height);

      // Carpet pattern
      for (let y = 40; y < officeCanvas.height; y += 80) {
        ctx.fillStyle = colors.carpetDark;
        for (let i = 0; i < 4; i++) {
          const patternX = aisleX + (aisleWidth / 2) - 20 + i * 4;
          ctx.fillRect(patternX, y + i * 2, 40 - i * 8, 2);
          ctx.fillRect(patternX, y + 16 - i * 2, 40 - i * 8, 2);
        }
        ctx.fillStyle = colors.goldDark;
        ctx.fillRect(aisleX + 20, y + 4, 8, 8);
        ctx.fillRect(aisleX + aisleWidth - 28, y + 4, 8, 8);
      }

      const sway = plantSway[officeAnimFrame % plantSway.length] * 2;

      // Draw plants at appropriate positions
      const plantX = isMobileView ? 15 : 100;
      const plantRightX = isMobileView ? officeCanvas.width - 55 : officeCanvas.width - 140;

      drawSimplePlant(plantX, officeCanvas.height / 2 - 100, sway);
      drawSimplePlant(plantRightX, officeCanvas.height / 2 - 100, -sway);
      drawSimplePlant(plantX, officeCanvas.height / 2 + 150, -sway);
      drawSimplePlant(plantRightX, officeCanvas.height / 2 + 150, sway);

      // Desks - now positioned outside the carpet aisle
      const deskColor = colors.desk;
      const deskDark = colors.deskDark;
      const topDeskY = 200;
      const bottomDeskY = officeCanvas.height - (isMobileView ? 340 : 280);

      // Left desks
      ctx.fillStyle = deskColor;
      ctx.fillRect(leftDeskX, topDeskY, deskWidth, deskHeight);
      ctx.fillRect(leftDeskX, bottomDeskY, deskWidth, deskHeight);
      ctx.fillStyle = deskDark;
      ctx.fillRect(leftDeskX, topDeskY + deskHeight - 10, deskWidth, 10);
      ctx.fillRect(leftDeskX, bottomDeskY + deskHeight - 10, deskWidth, 10);

      // Right desks
      ctx.fillStyle = deskColor;
      ctx.fillRect(rightDeskX, topDeskY, deskWidth, deskHeight);
      ctx.fillRect(rightDeskX, bottomDeskY, deskWidth, deskHeight);
      ctx.fillStyle = deskDark;
      ctx.fillRect(rightDeskX, topDeskY + deskHeight - 10, deskWidth, 10);
      ctx.fillRect(rightDeskX, bottomDeskY + deskHeight - 10, deskWidth, 10);

      // Lamp glows on desks
      drawLampGlow(ctx, leftDeskX + deskWidth / 2 - 20, topDeskY + 20);
      drawLampGlow(ctx, leftDeskX + deskWidth / 2 - 20, bottomDeskY + 20);
      drawLampGlow(ctx, rightDeskX + deskWidth / 2 - 20, topDeskY + 20);
      drawLampGlow(ctx, rightDeskX + deskWidth / 2 - 20, bottomDeskY + 20);

      // Floating dust particles
      updateAndDrawParticles(ctx);

      // Light rays from top
      drawLightRays(ctx);

      // Scales of justice
      const scalesX = officeCanvas.width / 2 - 40;
      const scalesY = 60;

      ctx.fillStyle = colors.wallLight;
      ctx.fillRect(scalesX + 16, scalesY + 64, 48, 12);
      ctx.fillRect(scalesX + 24, scalesY + 56, 32, 8);

      ctx.fillStyle = colors.gold;
      ctx.fillRect(scalesX + 36, scalesY, 8, 52);
      ctx.fillRect(scalesX, scalesY + 16, 80, 8);

      ctx.fillStyle = colors.goldDark;
      ctx.fillRect(scalesX + 8, scalesY + 24, 4, 16);
      ctx.fillRect(scalesX + 68, scalesY + 24, 4, 16);

      ctx.fillStyle = colors.gold;
      ctx.fillRect(scalesX, scalesY + 40, 24, 4);
      ctx.fillRect(scalesX + 56, scalesY + 40, 24, 4);
      ctx.fillRect(scalesX + 4, scalesY + 44, 16, 4);
      ctx.fillRect(scalesX + 60, scalesY + 44, 16, 4);

      // Vignette
      const vignette = ctx.createRadialGradient(
        officeCanvas.width / 2, officeCanvas.height / 2, 200,
        officeCanvas.width / 2, officeCanvas.height / 2, 700
      );
      vignette.addColorStop(0, 'rgba(0,0,0,0)');
      vignette.addColorStop(1, 'rgba(0,0,0,0.6)');
      ctx.fillStyle = vignette;
      ctx.fillRect(0, 0, officeCanvas.width, officeCanvas.height);

      officeAnimFrame++;
    }
    function gameLoop() {
      // Draw office background during gameplay, but not during start menu
      if (gameMode !== 'startMenu') {
        drawOfficeBackground();
      } else {
        // Black background for start menu
        officeCtx.fillStyle = '#000';
        officeCtx.fillRect(0, 0, officeCanvas.width, officeCanvas.height);
      }

      update();
      draw();
      requestAnimationFrame(gameLoop);
    }
    // INITIALIZE GAME
    initializeEvidence();
    createKeyboard();
    updateNameDisplay();
    updateHP();
    updateScore();

    // Start with name screen hidden
    document.getElementById('name-screen').classList.add('hidden');

    // Show start menu on load
    showStartMenu();

    window.addEventListener('resize', () => {
      officeCanvas.width = window.innerWidth;
      officeCanvas.height = window.innerHeight;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
    gameLoop();
  </script>
</body>

</html>
